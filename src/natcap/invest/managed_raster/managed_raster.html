<!DOCTYPE html>
<!-- Generated by Cython 0.29.37 -->
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Cython: managed_raster.pyx</title>
    <style type="text/css">
    
body.cython { font-family: courier; font-size: 12; }

.cython.tag  {  }
.cython.line { margin: 0em }
.cython.code { font-size: 9; color: #444444; display: none; margin: 0px 0px 0px 8px; border-left: 8px none; }

.cython.line .run { background-color: #B0FFB0; }
.cython.line .mis { background-color: #FFB0B0; }
.cython.code.run  { border-left: 8px solid #B0FFB0; }
.cython.code.mis  { border-left: 8px solid #FFB0B0; }

.cython.code .py_c_api  { color: red; }
.cython.code .py_macro_api  { color: #FF7000; }
.cython.code .pyx_c_api  { color: #FF3000; }
.cython.code .pyx_macro_api  { color: #FF7000; }
.cython.code .refnanny  { color: #FFA000; }
.cython.code .trace  { color: #FFA000; }
.cython.code .error_goto  { color: #FFA000; }

.cython.code .coerce  { color: #008000; border: 1px dotted #008000 }
.cython.code .py_attr { color: #FF0000; font-weight: bold; }
.cython.code .c_attr  { color: #0000FF; }
.cython.code .py_call { color: #FF0000; font-weight: bold; }
.cython.code .c_call  { color: #0000FF; }

.cython.score-0 {background-color: #FFFFff;}
.cython.score-1 {background-color: #FFFFe7;}
.cython.score-2 {background-color: #FFFFd4;}
.cython.score-3 {background-color: #FFFFc4;}
.cython.score-4 {background-color: #FFFFb6;}
.cython.score-5 {background-color: #FFFFaa;}
.cython.score-6 {background-color: #FFFF9f;}
.cython.score-7 {background-color: #FFFF96;}
.cython.score-8 {background-color: #FFFF8d;}
.cython.score-9 {background-color: #FFFF86;}
.cython.score-10 {background-color: #FFFF7f;}
.cython.score-11 {background-color: #FFFF79;}
.cython.score-12 {background-color: #FFFF73;}
.cython.score-13 {background-color: #FFFF6e;}
.cython.score-14 {background-color: #FFFF6a;}
.cython.score-15 {background-color: #FFFF66;}
.cython.score-16 {background-color: #FFFF62;}
.cython.score-17 {background-color: #FFFF5e;}
.cython.score-18 {background-color: #FFFF5b;}
.cython.score-19 {background-color: #FFFF57;}
.cython.score-20 {background-color: #FFFF55;}
.cython.score-21 {background-color: #FFFF52;}
.cython.score-22 {background-color: #FFFF4f;}
.cython.score-23 {background-color: #FFFF4d;}
.cython.score-24 {background-color: #FFFF4b;}
.cython.score-25 {background-color: #FFFF48;}
.cython.score-26 {background-color: #FFFF46;}
.cython.score-27 {background-color: #FFFF44;}
.cython.score-28 {background-color: #FFFF43;}
.cython.score-29 {background-color: #FFFF41;}
.cython.score-30 {background-color: #FFFF3f;}
.cython.score-31 {background-color: #FFFF3e;}
.cython.score-32 {background-color: #FFFF3c;}
.cython.score-33 {background-color: #FFFF3b;}
.cython.score-34 {background-color: #FFFF39;}
.cython.score-35 {background-color: #FFFF38;}
.cython.score-36 {background-color: #FFFF37;}
.cython.score-37 {background-color: #FFFF36;}
.cython.score-38 {background-color: #FFFF35;}
.cython.score-39 {background-color: #FFFF34;}
.cython.score-40 {background-color: #FFFF33;}
.cython.score-41 {background-color: #FFFF32;}
.cython.score-42 {background-color: #FFFF31;}
.cython.score-43 {background-color: #FFFF30;}
.cython.score-44 {background-color: #FFFF2f;}
.cython.score-45 {background-color: #FFFF2e;}
.cython.score-46 {background-color: #FFFF2d;}
.cython.score-47 {background-color: #FFFF2c;}
.cython.score-48 {background-color: #FFFF2b;}
.cython.score-49 {background-color: #FFFF2b;}
.cython.score-50 {background-color: #FFFF2a;}
.cython.score-51 {background-color: #FFFF29;}
.cython.score-52 {background-color: #FFFF29;}
.cython.score-53 {background-color: #FFFF28;}
.cython.score-54 {background-color: #FFFF27;}
.cython.score-55 {background-color: #FFFF27;}
.cython.score-56 {background-color: #FFFF26;}
.cython.score-57 {background-color: #FFFF26;}
.cython.score-58 {background-color: #FFFF25;}
.cython.score-59 {background-color: #FFFF24;}
.cython.score-60 {background-color: #FFFF24;}
.cython.score-61 {background-color: #FFFF23;}
.cython.score-62 {background-color: #FFFF23;}
.cython.score-63 {background-color: #FFFF22;}
.cython.score-64 {background-color: #FFFF22;}
.cython.score-65 {background-color: #FFFF22;}
.cython.score-66 {background-color: #FFFF21;}
.cython.score-67 {background-color: #FFFF21;}
.cython.score-68 {background-color: #FFFF20;}
.cython.score-69 {background-color: #FFFF20;}
.cython.score-70 {background-color: #FFFF1f;}
.cython.score-71 {background-color: #FFFF1f;}
.cython.score-72 {background-color: #FFFF1f;}
.cython.score-73 {background-color: #FFFF1e;}
.cython.score-74 {background-color: #FFFF1e;}
.cython.score-75 {background-color: #FFFF1e;}
.cython.score-76 {background-color: #FFFF1d;}
.cython.score-77 {background-color: #FFFF1d;}
.cython.score-78 {background-color: #FFFF1c;}
.cython.score-79 {background-color: #FFFF1c;}
.cython.score-80 {background-color: #FFFF1c;}
.cython.score-81 {background-color: #FFFF1c;}
.cython.score-82 {background-color: #FFFF1b;}
.cython.score-83 {background-color: #FFFF1b;}
.cython.score-84 {background-color: #FFFF1b;}
.cython.score-85 {background-color: #FFFF1a;}
.cython.score-86 {background-color: #FFFF1a;}
.cython.score-87 {background-color: #FFFF1a;}
.cython.score-88 {background-color: #FFFF1a;}
.cython.score-89 {background-color: #FFFF19;}
.cython.score-90 {background-color: #FFFF19;}
.cython.score-91 {background-color: #FFFF19;}
.cython.score-92 {background-color: #FFFF19;}
.cython.score-93 {background-color: #FFFF18;}
.cython.score-94 {background-color: #FFFF18;}
.cython.score-95 {background-color: #FFFF18;}
.cython.score-96 {background-color: #FFFF18;}
.cython.score-97 {background-color: #FFFF17;}
.cython.score-98 {background-color: #FFFF17;}
.cython.score-99 {background-color: #FFFF17;}
.cython.score-100 {background-color: #FFFF17;}
.cython.score-101 {background-color: #FFFF16;}
.cython.score-102 {background-color: #FFFF16;}
.cython.score-103 {background-color: #FFFF16;}
.cython.score-104 {background-color: #FFFF16;}
.cython.score-105 {background-color: #FFFF16;}
.cython.score-106 {background-color: #FFFF15;}
.cython.score-107 {background-color: #FFFF15;}
.cython.score-108 {background-color: #FFFF15;}
.cython.score-109 {background-color: #FFFF15;}
.cython.score-110 {background-color: #FFFF15;}
.cython.score-111 {background-color: #FFFF15;}
.cython.score-112 {background-color: #FFFF14;}
.cython.score-113 {background-color: #FFFF14;}
.cython.score-114 {background-color: #FFFF14;}
.cython.score-115 {background-color: #FFFF14;}
.cython.score-116 {background-color: #FFFF14;}
.cython.score-117 {background-color: #FFFF14;}
.cython.score-118 {background-color: #FFFF13;}
.cython.score-119 {background-color: #FFFF13;}
.cython.score-120 {background-color: #FFFF13;}
.cython.score-121 {background-color: #FFFF13;}
.cython.score-122 {background-color: #FFFF13;}
.cython.score-123 {background-color: #FFFF13;}
.cython.score-124 {background-color: #FFFF13;}
.cython.score-125 {background-color: #FFFF12;}
.cython.score-126 {background-color: #FFFF12;}
.cython.score-127 {background-color: #FFFF12;}
.cython.score-128 {background-color: #FFFF12;}
.cython.score-129 {background-color: #FFFF12;}
.cython.score-130 {background-color: #FFFF12;}
.cython.score-131 {background-color: #FFFF12;}
.cython.score-132 {background-color: #FFFF11;}
.cython.score-133 {background-color: #FFFF11;}
.cython.score-134 {background-color: #FFFF11;}
.cython.score-135 {background-color: #FFFF11;}
.cython.score-136 {background-color: #FFFF11;}
.cython.score-137 {background-color: #FFFF11;}
.cython.score-138 {background-color: #FFFF11;}
.cython.score-139 {background-color: #FFFF11;}
.cython.score-140 {background-color: #FFFF11;}
.cython.score-141 {background-color: #FFFF10;}
.cython.score-142 {background-color: #FFFF10;}
.cython.score-143 {background-color: #FFFF10;}
.cython.score-144 {background-color: #FFFF10;}
.cython.score-145 {background-color: #FFFF10;}
.cython.score-146 {background-color: #FFFF10;}
.cython.score-147 {background-color: #FFFF10;}
.cython.score-148 {background-color: #FFFF10;}
.cython.score-149 {background-color: #FFFF10;}
.cython.score-150 {background-color: #FFFF0f;}
.cython.score-151 {background-color: #FFFF0f;}
.cython.score-152 {background-color: #FFFF0f;}
.cython.score-153 {background-color: #FFFF0f;}
.cython.score-154 {background-color: #FFFF0f;}
.cython.score-155 {background-color: #FFFF0f;}
.cython.score-156 {background-color: #FFFF0f;}
.cython.score-157 {background-color: #FFFF0f;}
.cython.score-158 {background-color: #FFFF0f;}
.cython.score-159 {background-color: #FFFF0f;}
.cython.score-160 {background-color: #FFFF0f;}
.cython.score-161 {background-color: #FFFF0e;}
.cython.score-162 {background-color: #FFFF0e;}
.cython.score-163 {background-color: #FFFF0e;}
.cython.score-164 {background-color: #FFFF0e;}
.cython.score-165 {background-color: #FFFF0e;}
.cython.score-166 {background-color: #FFFF0e;}
.cython.score-167 {background-color: #FFFF0e;}
.cython.score-168 {background-color: #FFFF0e;}
.cython.score-169 {background-color: #FFFF0e;}
.cython.score-170 {background-color: #FFFF0e;}
.cython.score-171 {background-color: #FFFF0e;}
.cython.score-172 {background-color: #FFFF0e;}
.cython.score-173 {background-color: #FFFF0d;}
.cython.score-174 {background-color: #FFFF0d;}
.cython.score-175 {background-color: #FFFF0d;}
.cython.score-176 {background-color: #FFFF0d;}
.cython.score-177 {background-color: #FFFF0d;}
.cython.score-178 {background-color: #FFFF0d;}
.cython.score-179 {background-color: #FFFF0d;}
.cython.score-180 {background-color: #FFFF0d;}
.cython.score-181 {background-color: #FFFF0d;}
.cython.score-182 {background-color: #FFFF0d;}
.cython.score-183 {background-color: #FFFF0d;}
.cython.score-184 {background-color: #FFFF0d;}
.cython.score-185 {background-color: #FFFF0d;}
.cython.score-186 {background-color: #FFFF0d;}
.cython.score-187 {background-color: #FFFF0c;}
.cython.score-188 {background-color: #FFFF0c;}
.cython.score-189 {background-color: #FFFF0c;}
.cython.score-190 {background-color: #FFFF0c;}
.cython.score-191 {background-color: #FFFF0c;}
.cython.score-192 {background-color: #FFFF0c;}
.cython.score-193 {background-color: #FFFF0c;}
.cython.score-194 {background-color: #FFFF0c;}
.cython.score-195 {background-color: #FFFF0c;}
.cython.score-196 {background-color: #FFFF0c;}
.cython.score-197 {background-color: #FFFF0c;}
.cython.score-198 {background-color: #FFFF0c;}
.cython.score-199 {background-color: #FFFF0c;}
.cython.score-200 {background-color: #FFFF0c;}
.cython.score-201 {background-color: #FFFF0c;}
.cython.score-202 {background-color: #FFFF0c;}
.cython.score-203 {background-color: #FFFF0b;}
.cython.score-204 {background-color: #FFFF0b;}
.cython.score-205 {background-color: #FFFF0b;}
.cython.score-206 {background-color: #FFFF0b;}
.cython.score-207 {background-color: #FFFF0b;}
.cython.score-208 {background-color: #FFFF0b;}
.cython.score-209 {background-color: #FFFF0b;}
.cython.score-210 {background-color: #FFFF0b;}
.cython.score-211 {background-color: #FFFF0b;}
.cython.score-212 {background-color: #FFFF0b;}
.cython.score-213 {background-color: #FFFF0b;}
.cython.score-214 {background-color: #FFFF0b;}
.cython.score-215 {background-color: #FFFF0b;}
.cython.score-216 {background-color: #FFFF0b;}
.cython.score-217 {background-color: #FFFF0b;}
.cython.score-218 {background-color: #FFFF0b;}
.cython.score-219 {background-color: #FFFF0b;}
.cython.score-220 {background-color: #FFFF0b;}
.cython.score-221 {background-color: #FFFF0b;}
.cython.score-222 {background-color: #FFFF0a;}
.cython.score-223 {background-color: #FFFF0a;}
.cython.score-224 {background-color: #FFFF0a;}
.cython.score-225 {background-color: #FFFF0a;}
.cython.score-226 {background-color: #FFFF0a;}
.cython.score-227 {background-color: #FFFF0a;}
.cython.score-228 {background-color: #FFFF0a;}
.cython.score-229 {background-color: #FFFF0a;}
.cython.score-230 {background-color: #FFFF0a;}
.cython.score-231 {background-color: #FFFF0a;}
.cython.score-232 {background-color: #FFFF0a;}
.cython.score-233 {background-color: #FFFF0a;}
.cython.score-234 {background-color: #FFFF0a;}
.cython.score-235 {background-color: #FFFF0a;}
.cython.score-236 {background-color: #FFFF0a;}
.cython.score-237 {background-color: #FFFF0a;}
.cython.score-238 {background-color: #FFFF0a;}
.cython.score-239 {background-color: #FFFF0a;}
.cython.score-240 {background-color: #FFFF0a;}
.cython.score-241 {background-color: #FFFF0a;}
.cython.score-242 {background-color: #FFFF0a;}
.cython.score-243 {background-color: #FFFF0a;}
.cython.score-244 {background-color: #FFFF0a;}
.cython.score-245 {background-color: #FFFF0a;}
.cython.score-246 {background-color: #FFFF09;}
.cython.score-247 {background-color: #FFFF09;}
.cython.score-248 {background-color: #FFFF09;}
.cython.score-249 {background-color: #FFFF09;}
.cython.score-250 {background-color: #FFFF09;}
.cython.score-251 {background-color: #FFFF09;}
.cython.score-252 {background-color: #FFFF09;}
.cython.score-253 {background-color: #FFFF09;}
.cython.score-254 {background-color: #FFFF09;}
pre { line-height: 125%; }
td.linenos .normal { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
span.linenos { color: inherit; background-color: transparent; padding-left: 5px; padding-right: 5px; }
td.linenos .special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
span.linenos.special { color: #000000; background-color: #ffffc0; padding-left: 5px; padding-right: 5px; }
.cython .hll { background-color: #ffffcc }
.cython { background: #f8f8f8; }
.cython .c { color: #3D7B7B; font-style: italic } /* Comment */
.cython .err { border: 1px solid #FF0000 } /* Error */
.cython .k { color: #008000; font-weight: bold } /* Keyword */
.cython .o { color: #666666 } /* Operator */
.cython .ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
.cython .cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
.cython .cp { color: #9C6500 } /* Comment.Preproc */
.cython .cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
.cython .c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
.cython .cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
.cython .gd { color: #A00000 } /* Generic.Deleted */
.cython .ge { font-style: italic } /* Generic.Emph */
.cython .ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
.cython .gr { color: #E40000 } /* Generic.Error */
.cython .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.cython .gi { color: #008400 } /* Generic.Inserted */
.cython .go { color: #717171 } /* Generic.Output */
.cython .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.cython .gs { font-weight: bold } /* Generic.Strong */
.cython .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.cython .gt { color: #0044DD } /* Generic.Traceback */
.cython .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.cython .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.cython .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.cython .kp { color: #008000 } /* Keyword.Pseudo */
.cython .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.cython .kt { color: #B00040 } /* Keyword.Type */
.cython .m { color: #666666 } /* Literal.Number */
.cython .s { color: #BA2121 } /* Literal.String */
.cython .na { color: #687822 } /* Name.Attribute */
.cython .nb { color: #008000 } /* Name.Builtin */
.cython .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.cython .no { color: #880000 } /* Name.Constant */
.cython .nd { color: #AA22FF } /* Name.Decorator */
.cython .ni { color: #717171; font-weight: bold } /* Name.Entity */
.cython .ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
.cython .nf { color: #0000FF } /* Name.Function */
.cython .nl { color: #767600 } /* Name.Label */
.cython .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.cython .nt { color: #008000; font-weight: bold } /* Name.Tag */
.cython .nv { color: #19177C } /* Name.Variable */
.cython .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.cython .w { color: #bbbbbb } /* Text.Whitespace */
.cython .mb { color: #666666 } /* Literal.Number.Bin */
.cython .mf { color: #666666 } /* Literal.Number.Float */
.cython .mh { color: #666666 } /* Literal.Number.Hex */
.cython .mi { color: #666666 } /* Literal.Number.Integer */
.cython .mo { color: #666666 } /* Literal.Number.Oct */
.cython .sa { color: #BA2121 } /* Literal.String.Affix */
.cython .sb { color: #BA2121 } /* Literal.String.Backtick */
.cython .sc { color: #BA2121 } /* Literal.String.Char */
.cython .dl { color: #BA2121 } /* Literal.String.Delimiter */
.cython .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.cython .s2 { color: #BA2121 } /* Literal.String.Double */
.cython .se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
.cython .sh { color: #BA2121 } /* Literal.String.Heredoc */
.cython .si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
.cython .sx { color: #008000 } /* Literal.String.Other */
.cython .sr { color: #A45A77 } /* Literal.String.Regex */
.cython .s1 { color: #BA2121 } /* Literal.String.Single */
.cython .ss { color: #19177C } /* Literal.String.Symbol */
.cython .bp { color: #008000 } /* Name.Builtin.Pseudo */
.cython .fm { color: #0000FF } /* Name.Function.Magic */
.cython .vc { color: #19177C } /* Name.Variable.Class */
.cython .vg { color: #19177C } /* Name.Variable.Global */
.cython .vi { color: #19177C } /* Name.Variable.Instance */
.cython .vm { color: #19177C } /* Name.Variable.Magic */
.cython .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>
</head>
<body class="cython">
<p><span style="border-bottom: solid 1px grey;">Generated by Cython 0.29.37</span></p>
<p>
    <span style="background-color: #FFFF00">Yellow lines</span> hint at Python interaction.<br />
    Click on a line that starts with a "<code>+</code>" to see the C code that Cython generated for it.
</p>
<p>Raw output: <a href="managed_raster.cpp">managed_raster.cpp</a></p>
<div class="cython"><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">001</span>: <span class="c"># cython: profile=True</span></pre>
<pre class='cython code score-8 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_test, __pyx_t_2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 1, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">002</span>: <span class="c"># cython: language_level=3</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">003</span>: <span class="c"># distutils: language = c++</span></pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">004</span>: <span class="k">import</span> <span class="nn">os</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_os, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 4, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_os, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 4, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">005</span>: </pre>
<pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">006</span>: <span class="k">import</span> <span class="nn">numpy</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_numpy, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 6, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_numpy, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 6, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-8" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">007</span>: <span class="k">import</span> <span class="nn">pygeoprocessing</span></pre>
<pre class='cython code score-8 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_pygeoprocessing, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 7, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_pygeoprocessing, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 7, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">008</span>: <span class="k">cimport</span> <span class="nn">numpy</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">009</span>: <span class="k">cimport</span> <span class="nn">cython</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">010</span>: <span class="k">from</span> <span class="nn">osgeo</span> <span class="k">import</span> <span class="n">gdal</span></pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_n_s_gdal);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_n_s_gdal);
  <span class='py_macro_api'>PyList_SET_ITEM</span>(__pyx_t_1, 0, __pyx_n_s_gdal);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_Import</span>(__pyx_n_s_osgeo, __pyx_t_1, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_ImportFrom</span>(__pyx_t_2, __pyx_n_s_gdal);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_d, __pyx_n_s_gdal, __pyx_t_1) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 10, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">011</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">012</span>: <span class="k">from</span> <span class="nn">cpython.mem</span> <span class="k">cimport</span> <span class="n">PyMem_Malloc</span><span class="p">,</span> <span class="n">PyMem_Free</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">013</span>: <span class="k">from</span> <span class="nn">cython.operator</span> <span class="k">cimport</span> <span class="n">dereference</span> <span class="k">as</span> <span class="n">deref</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">014</span>: <span class="k">from</span> <span class="nn">cython.operator</span> <span class="k">cimport</span> <span class="n">preincrement</span> <span class="k">as</span> <span class="n">inc</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">015</span>: <span class="k">from</span> <span class="nn">libc.time</span> <span class="k">cimport</span> <span class="n">time</span> <span class="k">as</span> <span class="n">ctime</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">016</span>: <span class="k">from</span> <span class="nn">libcpp.pair</span> <span class="k">cimport</span> <span class="n">pair</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">017</span>: <span class="k">from</span> <span class="nn">libcpp.set</span> <span class="k">cimport</span> <span class="nb">set</span> <span class="k">as</span> <span class="n">cset</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">018</span>: <span class="k">from</span> <span class="nn">libcpp.list</span> <span class="k">cimport</span> <span class="nb">list</span> <span class="k">as</span> <span class="n">clist</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">019</span>: <span class="k">from</span> <span class="nn">libcpp.stack</span> <span class="k">cimport</span> <span class="n">stack</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">020</span>: <span class="k">cimport</span> <span class="nn">libc.math</span> <span class="k">as</span> <span class="nn">cmath</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">021</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">022</span>: <span class="c"># this ctype is used to store the block ID and the block buffer as one object</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">023</span>: <span class="c"># inside Managed Raster</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">024</span>: <span class="k">ctypedef</span> <span class="n">pair</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">double</span><span class="o">*</span><span class="p">]</span> <span class="n">BlockBufferPair</span></pre>
<pre class='cython code score-0 '>typedef std::pair&lt;int,double *&gt;  __pyx_t_6natcap_6invest_14managed_raster_14managed_raster_BlockBufferPair;
</pre><pre class="cython line score-0">&#xA0;<span class="">025</span>: <span class="c"># Number of raster blocks to hold in memory at once per Managed Raster</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">026</span>: <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">MANAGED_RASTER_N_BLOCKS</span> <span class="o">=</span> <span class="mf">2</span><span class="o">**</span><span class="mf">6</span></pre>
<pre class='cython code score-0 '>  __pyx_v_6natcap_6invest_14managed_raster_14managed_raster_MANAGED_RASTER_N_BLOCKS = 64;
</pre><pre class="cython line score-0">&#xA0;<span class="">027</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">028</span>: <span class="c"># These offsets are for the neighbor rows and columns according to the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">029</span>: <span class="c"># ordering: 3 2 1</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">030</span>: <span class="c">#           4 x 0</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">031</span>: <span class="c">#           5 6 7</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">032</span>: <span class="k">cdef</span> <span class="kt">int</span> *<span class="nf">ROW_OFFSETS</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1</span><span class="p">,</span>  <span class="mf">0</span><span class="p">,</span>  <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_3[0] = 0;
  __pyx_t_3[1] = -1;
  __pyx_t_3[2] = -1;
  __pyx_t_3[3] = -1;
  __pyx_t_3[4] = 0;
  __pyx_t_3[5] = 1;
  __pyx_t_3[6] = 1;
  __pyx_t_3[7] = 1;
  __pyx_v_6natcap_6invest_14managed_raster_14managed_raster_ROW_OFFSETS = __pyx_t_3;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">033</span>: <span class="k">cdef</span> <span class="kt">int</span> *<span class="nf">COL_OFFSETS</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1</span><span class="p">,</span>  <span class="mf">1</span><span class="p">,</span>  <span class="mf">0</span><span class="p">,</span> <span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">1</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_4[0] = 1;
  __pyx_t_4[1] = 1;
  __pyx_t_4[2] = 0;
  __pyx_t_4[3] = -1;
  __pyx_t_4[4] = -1;
  __pyx_t_4[5] = -1;
  __pyx_t_4[6] = 0;
  __pyx_t_4[7] = 1;
  __pyx_v_6natcap_6invest_14managed_raster_14managed_raster_COL_OFFSETS = __pyx_t_4;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">034</span>: <span class="k">cdef</span> <span class="kt">int</span>* <span class="nf">FLOW_DIR_REVERSE_DIRECTION</span> <span class="o">=</span> <span class="p">[</span><span class="mf">4</span><span class="p">,</span> <span class="mf">5</span><span class="p">,</span> <span class="mf">6</span><span class="p">,</span> <span class="mf">7</span><span class="p">,</span> <span class="mf">0</span><span class="p">,</span> <span class="mf">1</span><span class="p">,</span> <span class="mf">2</span><span class="p">,</span> <span class="mf">3</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>  __pyx_t_5[0] = 4;
  __pyx_t_5[1] = 5;
  __pyx_t_5[2] = 6;
  __pyx_t_5[3] = 7;
  __pyx_t_5[4] = 0;
  __pyx_t_5[5] = 1;
  __pyx_t_5[6] = 2;
  __pyx_t_5[7] = 3;
  __pyx_v_6natcap_6invest_14managed_raster_14managed_raster_FLOW_DIR_REVERSE_DIRECTION = __pyx_t_5;
</pre><pre class="cython line score-0">&#xA0;<span class="">035</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">036</span>: <span class="c"># a class to allow fast random per-pixel access to a raster for both setting</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">037</span>: <span class="c"># and reading pixels.  Copied from src/pygeoprocessing/routing/routing.pyx,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">038</span>: <span class="c"># revision 891288683889237cfd3a3d0a1f09483c23489fca.</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">039</span>: <span class="k">cdef</span> <span class="k">class</span> <span class="nf">_ManagedRaster</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>struct __pyx_vtabstruct_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster {
  void (*set)(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *, long, long, double);
  double (*get)(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *, long, long);
  void (*_load_block)(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *, int);
};
static struct __pyx_vtabstruct_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *__pyx_vtabptr_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster;
static CYTHON_INLINE void __pyx_f_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_set(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *, long, long, double);
static CYTHON_INLINE double __pyx_f_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_get(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *, long, long);

</pre><pre class="cython line score-0">&#xA0;<span class="">040</span>: </pre>
<pre class="cython line score-48" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">041</span>:     <span class="k">def</span> <span class="nf">__cinit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster_path</span><span class="p">,</span> <span class="n">band_id</span><span class="p">,</span> <span class="n">write_mode</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span></pre>
<pre class='cython code score-48 '>/* Python wrapper */
static int __pyx_pw_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_1__cinit__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  PyObject *__pyx_v_raster_path = 0;
  PyObject *__pyx_v_band_id = 0;
  PyObject *__pyx_v_write_mode = 0;
  CYTHON_UNUSED PyObject *__pyx_v_args = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__cinit__ (wrapper)", 0);
  if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) &gt; 3) {
    __pyx_v_args = <span class='py_c_api'>PyTuple_GetSlice</span>(__pyx_args, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args));
    if (unlikely(!__pyx_v_args)) {
      <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
      return -1;
    }
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_args);
  } else {
    __pyx_v_args = __pyx_empty_tuple; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_empty_tuple);
  }
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_raster_path,&amp;__pyx_n_s_band_id,&amp;__pyx_n_s_write_mode,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        default:
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_raster_path)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_band_id)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 0, 3, 3, 1); <span class='error_goto'>__PYX_ERR(0, 41, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_write_mode)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 0, 3, 3, 2); <span class='error_goto'>__PYX_ERR(0, 41, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        const Py_ssize_t used_pos_args = (pos_args &lt; 3) ? pos_args : 3;
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, used_pos_args, "__cinit__") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 41, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) &lt; 3) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
    }
    __pyx_v_raster_path = values[0];
    __pyx_v_band_id = values[1];
    __pyx_v_write_mode = values[2];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__cinit__", 0, 3, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 41, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_args); __pyx_v_args = 0;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("natcap.invest.managed_raster.managed_raster._ManagedRaster.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster___cinit__(((struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *)__pyx_v_self), __pyx_v_raster_path, __pyx_v_band_id, __pyx_v_write_mode, __pyx_v_args);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_args);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster___cinit__(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *__pyx_v_self, PyObject *__pyx_v_raster_path, PyObject *__pyx_v_band_id, PyObject *__pyx_v_write_mode, CYTHON_UNUSED PyObject *__pyx_v_args) {
  PyObject *__pyx_v_raster_info = NULL;
  PyObject *__pyx_v_err_msg = NULL;
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__cinit__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__cinit__", __pyx_f[0], 41, 0, <span class='error_goto'>__PYX_ERR(0, 41, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("natcap.invest.managed_raster.managed_raster._ManagedRaster.__cinit__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_raster_info);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_err_msg);
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">042</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;Create new instance of Managed Raster.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">043</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">044</span>: <span class="sd">        Args:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">045</span>: <span class="sd">            raster_path (char*): path to raster that has block sizes that are</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">046</span>: <span class="sd">                powers of 2. If not, an exception is raised.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">047</span>: <span class="sd">            band_id (int): which band in `raster_path` to index. Uses GDAL</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">048</span>: <span class="sd">                notation that starts at 1.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">049</span>: <span class="sd">            write_mode (boolean): if true, this raster is writable and dirty</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">050</span>: <span class="sd">                memory blocks will be written back to the raster as blocks</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">051</span>: <span class="sd">                are swapped out of the cache or when the object deconstructs.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">052</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">053</span>: <span class="sd">        Returns:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">054</span>: <span class="sd">            None.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">055</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">056</span>:         <span class="n">raster_info</span> <span class="o">=</span> <span class="n">pygeoprocessing</span><span class="o">.</span><span class="n">get_raster_info</span><span class="p">(</span><span class="n">raster_path</span><span class="p">)</span></pre>
<pre class='cython code score-19 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_pygeoprocessing);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 56, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_get_raster_info);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 56, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_3))) {
    __pyx_t_2 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_3);
    if (likely(__pyx_t_2)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_3, function);
    }
  }
  __pyx_t_1 = (__pyx_t_2) ? __Pyx_PyObject_Call2Args(__pyx_t_3, __pyx_t_2, __pyx_v_raster_path) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_3, __pyx_v_raster_path);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 56, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_raster_info = __pyx_t_1;
  __pyx_t_1 = 0;
</pre><pre class="cython line score-62" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">057</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">raster_x_size</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_y_size</span> <span class="o">=</span> <span class="n">raster_info</span><span class="p">[</span><span class="s">&#39;raster_size&#39;</span><span class="p">]</span></pre>
<pre class='cython code score-62 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_raster_info, __pyx_n_u_raster_size);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
    if (unlikely(size != 2)) {
      if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L1_error)</span>
    }
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
    } else {
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    #else
    __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 57, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = Py_TYPE(__pyx_t_4)-&gt;tp_iternext;
    index = 0; __pyx_t_3 = __pyx_t_5(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L3_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    index = 1; __pyx_t_2 = __pyx_t_5(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L3_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_5(__pyx_t_4), 2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L1_error)</span>
    __pyx_t_5 = NULL;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L4_unpacking_done;
    __pyx_L3_unpacking_failed:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
    if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
    <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L1_error)</span>
    __pyx_L4_unpacking_done:;
  }
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_3); if (unlikely((__pyx_t_6 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_2); if (unlikely((__pyx_t_7 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 57, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_v_self-&gt;raster_x_size = __pyx_t_6;
  __pyx_v_self-&gt;raster_y_size = __pyx_t_7;
</pre><pre class="cython line score-62" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">058</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span> <span class="o">=</span> <span class="n">raster_info</span><span class="p">[</span><span class="s">&#39;block_size&#39;</span><span class="p">]</span></pre>
<pre class='cython code score-62 '>  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_raster_info, __pyx_n_u_block_size);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 58, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_1))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_1))) {
    PyObject* sequence = __pyx_t_1;
    Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
    if (unlikely(size != 2)) {
      if (size &gt; 2) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(2);
      else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
      <span class='error_goto'>__PYX_ERR(0, 58, __pyx_L1_error)</span>
    }
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
      __pyx_t_2 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
      __pyx_t_3 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
    } else {
      __pyx_t_2 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
      __pyx_t_3 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
    #else
    __pyx_t_2 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 0);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 58, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, 1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 58, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    #endif
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  } else {
    Py_ssize_t index = -1;
    __pyx_t_4 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 58, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_5 = Py_TYPE(__pyx_t_4)-&gt;tp_iternext;
    index = 0; __pyx_t_2 = __pyx_t_5(__pyx_t_4); if (unlikely(!__pyx_t_2)) goto __pyx_L5_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    index = 1; __pyx_t_3 = __pyx_t_5(__pyx_t_4); if (unlikely(!__pyx_t_3)) goto __pyx_L5_unpacking_failed;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_5(__pyx_t_4), 2) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 58, __pyx_L1_error)</span>
    __pyx_t_5 = NULL;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    goto __pyx_L6_unpacking_done;
    __pyx_L5_unpacking_failed:;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_5 = NULL;
    if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
    <span class='error_goto'>__PYX_ERR(0, 58, __pyx_L1_error)</span>
    __pyx_L6_unpacking_done:;
  }
  __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_8 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 58, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3); if (unlikely((__pyx_t_9 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 58, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self-&gt;block_xsize = __pyx_t_8;
  __pyx_v_self-&gt;block_ysize = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">059</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">block_xmod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span><span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;block_xmod = (__pyx_v_self-&gt;block_xsize - 1);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">060</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">block_ymod</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span><span class="o">-</span><span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;block_ymod = (__pyx_v_self-&gt;block_ysize - 1);
</pre><pre class="cython line score-0">&#xA0;<span class="">061</span>: </pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">062</span>:         <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="mf">1</span> <span class="o">&lt;=</span> <span class="n">band_id</span> <span class="o">&lt;=</span> <span class="n">raster_info</span><span class="p">[</span><span class="s">&#39;n_bands&#39;</span><span class="p">]):</span></pre>
<pre class='cython code score-19 '>  __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_int_1, __pyx_v_band_id, Py_LE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 62, __pyx_L1_error)</span>
  if (<span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1)) {
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Dict_GetItem</span>(__pyx_v_raster_info, __pyx_n_u_n_bands);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 62, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_1 = <span class='py_c_api'>PyObject_RichCompare</span>(__pyx_v_band_id, __pyx_t_3, Py_LE); <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 62, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  }
  __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(__pyx_t_1); if (unlikely(__pyx_t_10 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 62, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_11 = ((!__pyx_t_10) != 0);
  if (unlikely(__pyx_t_11)) {
/* … */
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">063</span>:             <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">064</span>:                 <span class="s">&quot;Error: band ID (</span><span class="si">%s</span><span class="s">) is not a valid band number. &quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">065</span>:                 <span class="s">&quot;This exception is happening in Cython, so it will cause a &quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">066</span>:                 <span class="s">&quot;hard seg-fault, but it&#39;s otherwise meant to be a &quot;</span></pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">067</span>:                 <span class="s">&quot;ValueError.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">band_id</span><span class="p">))</span></pre>
<pre class='cython code score-2 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyUnicode_FormatSafe</span>(__pyx_kp_u_Error_band_ID_s_is_not_a_valid_b, __pyx_v_band_id);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 67, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_v_err_msg = ((PyObject*)__pyx_t_1);
    __pyx_t_1 = 0;
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">068</span>:             <span class="k">print</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span></pre>
<pre class='cython code score-3 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_print, __pyx_v_err_msg);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 68, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">069</span>:             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_ValueError, __pyx_v_err_msg);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 69, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_1, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    <span class='error_goto'>__PYX_ERR(0, 69, __pyx_L1_error)</span>
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">070</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">band_id</span> <span class="o">=</span> <span class="n">band_id</span></pre>
<pre class='cython code score-7 '>  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_band_id); if (unlikely((__pyx_t_9 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 70, __pyx_L1_error)</span>
  __pyx_v_self-&gt;band_id = __pyx_t_9;
</pre><pre class="cython line score-0">&#xA0;<span class="">071</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">072</span>:         <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span></pre>
<pre class='cython code score-0 '>  __pyx_t_10 = (((__pyx_v_self-&gt;block_xsize &amp; (__pyx_v_self-&gt;block_xsize - 1)) != 0) != 0);
  if (!__pyx_t_10) {
  } else {
    __pyx_t_11 = __pyx_t_10;
    goto __pyx_L9_bool_binop_done;
  }
/* … */
  if (unlikely(__pyx_t_11)) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">073</span>:                 <span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mf">0</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_10 = (((__pyx_v_self-&gt;block_ysize &amp; (__pyx_v_self-&gt;block_ysize - 1)) != 0) != 0);
  __pyx_t_11 = __pyx_t_10;
  __pyx_L9_bool_binop_done:;
</pre><pre class="cython line score-0">&#xA0;<span class="">074</span>:             <span class="c"># If inputs are not a power of two, this will at least print</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">075</span>:             <span class="c"># an error message. Unfortunately with Cython, the exception will</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">076</span>:             <span class="c"># present itself as a hard seg-fault, but I&#39;m leaving the</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">077</span>:             <span class="c"># ValueError in here at least for readability.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">078</span>:             <span class="n">err_msg</span> <span class="o">=</span> <span class="p">(</span></pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">079</span>:                 <span class="s">&quot;Error: Block size is not a power of two: &quot;</span></pre>
<pre class='cython code score-10 '>    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(7);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 79, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_12 = 0;
    __pyx_t_13 = 127;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_Error_Block_size_is_not_a_power);
    __pyx_t_12 += 54;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_Error_Block_size_is_not_a_power);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_kp_u_Error_Block_size_is_not_a_power);
/* … */
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyUnicode_Join</span>(__pyx_t_1, 7, __pyx_t_12, __pyx_t_13);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 79, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_v_err_msg = ((PyObject*)__pyx_t_3);
    __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">080</span>:                 <span class="s">&quot;block_xsize: </span><span class="si">%d</span><span class="s">, </span><span class="si">%d</span><span class="s">, </span><span class="si">%s</span><span class="s">. This exception is happening&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">081</span>:                 <span class="s">&quot;in Cython, so it will cause a hard seg-fault, but it&#39;s&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">082</span>:                 <span class="s">&quot;otherwise meant to be a ValueError.&quot;</span> <span class="o">%</span> <span class="p">(</span></pre>
<pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">083</span>:                     <span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span><span class="p">,</span> <span class="n">raster_path</span><span class="p">))</span></pre>
<pre class='cython code score-30 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyUnicode_From_int</span>(__pyx_v_self-&gt;block_xsize, 0, ' ', 'd');<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 83, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_12 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_3);
    __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_);
    __pyx_t_12 += 2;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_kp_u_);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyUnicode_From_int</span>(__pyx_v_self-&gt;block_ysize, 0, ' ', 'd');<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 83, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_12 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, __pyx_t_3);
    __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_);
    __pyx_t_12 += 2;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 4, __pyx_kp_u_);
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_FormatSimpleAndDecref</span>(<span class='py_c_api'>PyObject_Unicode</span>(__pyx_v_raster_path), __pyx_empty_unicode);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 83, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_13 = (<span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_3) &gt; __pyx_t_13) ? <span class='pyx_c_api'>__Pyx_PyUnicode_MAX_CHAR_VALUE</span>(__pyx_t_3) : __pyx_t_13;
    __pyx_t_12 += <span class='pyx_c_api'>__Pyx_PyUnicode_GET_LENGTH</span>(__pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 5, __pyx_t_3);
    __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_kp_u_This_exception_is_happeningin_C);
    __pyx_t_12 += 118;
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_kp_u_This_exception_is_happeningin_C);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 6, __pyx_kp_u_This_exception_is_happeningin_C);
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">084</span>:             <span class="k">print</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span></pre>
<pre class='cython code score-3 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_print, __pyx_v_err_msg);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 84, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">085</span>:             <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">err_msg</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_ValueError, __pyx_v_err_msg);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 85, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_c_api'>__Pyx_Raise</span>(__pyx_t_3, 0, 0, 0);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='error_goto'>__PYX_ERR(0, 85, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">086</span>: </pre>
<pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">087</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">block_xbits</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span><span class="p">)</span></pre>
<pre class='cython code score-30 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_1, __pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 87, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_1, __pyx_n_s_log2);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 87, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_self-&gt;block_xsize);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 87, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_2, __pyx_t_4, __pyx_t_1) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 87, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3); if (unlikely((__pyx_t_9 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 87, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self-&gt;block_xbits = __pyx_t_9;
</pre><pre class="cython line score-30" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">088</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">block_ybits</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span><span class="p">)</span></pre>
<pre class='cython code score-30 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_2, __pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 88, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_2, __pyx_n_s_log2);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 88, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_self-&gt;block_ysize);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 88, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_1))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_1);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_1, function);
    }
  }
  __pyx_t_3 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_1, __pyx_t_4, __pyx_t_2) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_1, __pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 88, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_3); if (unlikely((__pyx_t_9 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 88, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_v_self-&gt;block_ybits = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">089</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">block_nx</span> <span class="o">=</span> <span class="p">(</span></pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;block_nx = __Pyx_div_long(__pyx_t_7, __pyx_v_self-&gt;block_xsize);
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">090</span>:             <span class="bp">self</span><span class="o">.</span><span class="n">raster_x_size</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span></pre>
<pre class='cython code score-10 '>  __pyx_t_7 = ((__pyx_v_self-&gt;raster_x_size + __pyx_v_self-&gt;block_xsize) - 1);
  if (unlikely(__pyx_v_self-&gt;block_xsize == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "integer division or modulo by zero");
    <span class='error_goto'>__PYX_ERR(0, 90, __pyx_L1_error)</span>
  }
  else if (sizeof(long) == sizeof(long) &amp;&amp; (!(((int)-1) &gt; 0)) &amp;&amp; unlikely(__pyx_v_self-&gt;block_xsize == (int)-1)  &amp;&amp; unlikely(UNARY_NEG_WOULD_OVERFLOW(__pyx_t_7))) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_OverflowError, "value too large to perform division");
    <span class='error_goto'>__PYX_ERR(0, 90, __pyx_L1_error)</span>
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">091</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">block_ny</span> <span class="o">=</span> <span class="p">(</span></pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;block_ny = __Pyx_div_long(__pyx_t_7, __pyx_v_self-&gt;block_ysize);
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">092</span>:             <span class="bp">self</span><span class="o">.</span><span class="n">raster_y_size</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span><span class="p">)</span> <span class="o">-</span> <span class="mf">1</span><span class="p">)</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span></pre>
<pre class='cython code score-10 '>  __pyx_t_7 = ((__pyx_v_self-&gt;raster_y_size + __pyx_v_self-&gt;block_ysize) - 1);
  if (unlikely(__pyx_v_self-&gt;block_ysize == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "integer division or modulo by zero");
    <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span>
  }
  else if (sizeof(long) == sizeof(long) &amp;&amp; (!(((int)-1) &gt; 0)) &amp;&amp; unlikely(__pyx_v_self-&gt;block_ysize == (int)-1)  &amp;&amp; unlikely(UNARY_NEG_WOULD_OVERFLOW(__pyx_t_7))) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_OverflowError, "value too large to perform division");
    <span class='error_goto'>__PYX_ERR(0, 92, __pyx_L1_error)</span>
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">093</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">094</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">lru_cache</span> <span class="o">=</span> <span class="n">new</span> <span class="n">LRUCache</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="n">double</span><span class="o">*</span><span class="p">](</span><span class="n">MANAGED_RASTER_N_BLOCKS</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;lru_cache = new LRUCache&lt;int,double *&gt; (__pyx_v_6natcap_6invest_14managed_raster_14managed_raster_MANAGED_RASTER_N_BLOCKS);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">095</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">raster_path</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">bytes</span><span class="p">&gt;</span> <span class="n">raster_path</span></pre>
<pre class='cython code score-2 '>  __pyx_t_3 = __pyx_v_raster_path;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_v_self-&gt;raster_path);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_v_self-&gt;raster_path);
  __pyx_v_self-&gt;raster_path = ((PyObject*)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">096</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">write_mode</span> <span class="o">=</span> <span class="n">write_mode</span></pre>
<pre class='cython code score-7 '>  __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_write_mode); if (unlikely((__pyx_t_9 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 96, __pyx_L1_error)</span>
  __pyx_v_self-&gt;write_mode = __pyx_t_9;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">097</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;closed = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">098</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">099</span>:     <span class="k">def</span> <span class="nf">__dealloc__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre>
<pre class='cython code score-5 '>/* Python wrapper */
static void __pyx_pw_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_3__dealloc__(PyObject *__pyx_v_self); /*proto*/
static void __pyx_pw_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_3__dealloc__(PyObject *__pyx_v_self) {
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__dealloc__ (wrapper)", 0);
  __pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_2__dealloc__(((struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *)__pyx_v_self));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}

static void __pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_2__dealloc__(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *__pyx_v_self) {
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__dealloc__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__dealloc__", __pyx_f[0], 99, 0, <span class='error_goto'>__PYX_ERR(0, 99, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("natcap.invest.managed_raster.managed_raster._ManagedRaster.__dealloc__", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-0">&#xA0;<span class="">100</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;Deallocate _ManagedRaster.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">101</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">102</span>: <span class="sd">        This operation manually frees memory from the LRUCache and writes any</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">103</span>: <span class="sd">        dirty memory blocks back to the raster if `self.write_mode` is True.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">104</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">105</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></pre>
<pre class='cython code score-19 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_close);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 105, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
    }
  }
  __pyx_t_1 = (__pyx_t_3) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_2, __pyx_t_3) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (unlikely(!__pyx_t_1)) <span class='error_goto'>__PYX_ERR(0, 105, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">106</span>: </pre>
<pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">107</span>:     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span></pre>
<pre class='cython code score-20 '>/* Python wrapper */
static PyObject *__pyx_pw_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_5close(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused); /*proto*/
static char __pyx_doc_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_4close[] = "Close the _ManagedRaster and free up resources.\n\n            This call writes any dirty blocks to disk, frees up the memory\n            allocated as part of the cache, and frees all GDAL references.\n\n            Any subsequent calls to any other functions in _ManagedRaster will\n            have undefined behavior.\n        ";
static PyObject *__pyx_pw_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_5close(PyObject *__pyx_v_self, CYTHON_UNUSED PyObject *unused) {
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("close (wrapper)", 0);
  __pyx_r = __pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_4close(((struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *)__pyx_v_self));

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_4close(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *__pyx_v_self) {
  int __pyx_v_xi_copy;
  int __pyx_v_yi_copy;
  PyArrayObject *__pyx_v_block_array = 0;
  double *__pyx_v_double_buffer;
  int __pyx_v_block_xi;
  int __pyx_v_block_yi;
  int __pyx_v_win_xsize;
  int __pyx_v_win_ysize;
  int __pyx_v_xoff;
  int __pyx_v_yoff;
  std::list&lt;__pyx_t_6natcap_6invest_14managed_raster_14managed_raster_BlockBufferPair&gt; ::iterator __pyx_v_it;
  std::list&lt;__pyx_t_6natcap_6invest_14managed_raster_14managed_raster_BlockBufferPair&gt; ::iterator __pyx_v_end;
  PyObject *__pyx_v_raster = NULL;
  PyObject *__pyx_v_raster_band = NULL;
  std::set&lt;int&gt; ::iterator __pyx_v_dirty_itr;
  PyObject *__pyx_v_block_index = NULL;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_block_array;
  __Pyx_Buffer __pyx_pybuffer_block_array;
  PyObject *__pyx_r = NULL;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("close", 0);
  <span class='trace'>__Pyx_TraceCall</span>("close", __pyx_f[0], 107, 0, <span class='error_goto'>__PYX_ERR(0, 107, __pyx_L1_error)</span>);
  __pyx_pybuffer_block_array.pybuffer.buf = NULL;
  __pyx_pybuffer_block_array.refcount = 0;
  __pyx_pybuffernd_block_array.data = NULL;
  __pyx_pybuffernd_block_array.rcbuffer = &amp;__pyx_pybuffer_block_array;
/* … */
  /* function exit code */
  __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("natcap.invest.managed_raster.managed_raster._ManagedRaster.close", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_block_array);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_raster);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_raster_band);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_block_index);
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">108</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;Close the _ManagedRaster and free up resources.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">109</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">110</span>: <span class="sd">            This call writes any dirty blocks to disk, frees up the memory</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">111</span>: <span class="sd">            allocated as part of the cache, and frees all GDAL references.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">112</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">113</span>: <span class="sd">            Any subsequent calls to any other functions in _ManagedRaster will</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">114</span>: <span class="sd">            have undefined behavior.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">115</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">116</span>:         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">closed</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;closed != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">117</span>:             <span class="k">return</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">118</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">closed</span> <span class="o">=</span> <span class="mf">1</span></pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;closed = 1;
</pre><pre class="cython line score-0">&#xA0;<span class="">119</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">xi_copy</span><span class="p">,</span> <span class="nf">yi_copy</span></pre>
<pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">120</span>:         <span class="k">cdef</span> <span class="kt">numpy</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">block_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span></pre>
<pre class='cython code score-10 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 120, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 120, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
/* … */
  if (!(likely(((__pyx_t_2) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_2, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 120, __pyx_L1_error)</span>
  __pyx_t_7 = ((PyArrayObject *)__pyx_t_2);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_7, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
      __pyx_v_block_array = ((PyArrayObject *)Py_None); <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None); __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.buf = NULL;
      <span class='error_goto'>__PYX_ERR(0, 120, __pyx_L1_error)</span>
    } else {__pyx_pybuffernd_block_array.diminfo[0].strides = __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_block_array.diminfo[0].shape = __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_block_array.diminfo[1].strides = __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_block_array.diminfo[1].shape = __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.shape[1];
    }
  }
  __pyx_t_7 = 0;
  __pyx_v_block_array = ((PyArrayObject *)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">121</span>:             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span><span class="p">))</span></pre>
<pre class='cython code score-26 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_self-&gt;block_ysize);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 121, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_self-&gt;block_xsize);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 121, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 121, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_5);
  __pyx_t_3 = 0;
  __pyx_t_5 = 0;
  __pyx_t_5 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_2 = (__pyx_t_5) ? __Pyx_PyObject_Call2Args(__pyx_t_4, __pyx_t_5, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 120, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">122</span>:         <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">double_buffer</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">123</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">block_xi</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">124</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">block_yi</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">125</span>:         <span class="c"># initially the win size is the same as the block size unless</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">126</span>:         <span class="c"># we&#39;re at the edge of a raster</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">127</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">win_xsize</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">128</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">win_ysize</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">129</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">130</span>:         <span class="c"># we need the offsets to subtract from global indexes for cached array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">131</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">xoff</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">132</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">yoff</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">133</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">134</span>:         <span class="k">cdef</span> <span class="kt">clist</span>[<span class="kt">BlockBufferPair</span>].<span class="kt">iterator</span> <span class="nf">it</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lru_cache</span><span class="o">.</span><span class="n">begin</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>  __pyx_v_it = __pyx_v_self-&gt;lru_cache-&gt;begin();
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">135</span>:         <span class="k">cdef</span> <span class="kt">clist</span>[<span class="kt">BlockBufferPair</span>].<span class="kt">iterator</span> <span class="nf">end</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lru_cache</span><span class="o">.</span><span class="n">end</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>  __pyx_v_end = __pyx_v_self-&gt;lru_cache-&gt;end();
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">136</span>:         <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_mode</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((!(__pyx_v_self-&gt;write_mode != 0)) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">137</span>:             <span class="k">while</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">end</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    while (1) {
      __pyx_t_1 = ((__pyx_v_it != __pyx_v_end) != 0);
      if (!__pyx_t_1) break;
</pre><pre class="cython line score-0">&#xA0;<span class="">138</span>:                 <span class="c"># write the changed value back if desired</span></pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">139</span>:                 <span class="n">PyMem_Free</span><span class="p">(</span><span class="n">deref</span><span class="p">(</span><span class="n">it</span><span class="p">)</span><span class="o">.</span><span class="n">second</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>      <span class='py_c_api'>PyMem_Free</span>((*__pyx_v_it).second);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">140</span>:                 <span class="n">inc</span><span class="p">(</span><span class="n">it</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      (void)((++__pyx_v_it));
    }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">141</span>:             <span class="k">return</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r);
    __pyx_r = Py_None; <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">142</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">143</span>:         <span class="n">raster</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">OpenEx</span><span class="p">(</span></pre>
<pre class='cython code score-5 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_gdal);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_OpenEx);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-55" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">144</span>:             <span class="bp">self</span><span class="o">.</span><span class="n">raster_path</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GA_Update</span> <span class="o">|</span> <span class="n">gdal</span><span class="o">.</span><span class="n">OF_RASTER</span><span class="p">)</span></pre>
<pre class='cython code score-55 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_gdal);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_GA_Update);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_gdal);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_OF_RASTER);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = <span class='py_c_api'>PyNumber_Or</span>(__pyx_t_5, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 144, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  __pyx_t_3 = NULL;
  __pyx_t_8 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_3 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_3)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
      __pyx_t_8 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_6)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_self-&gt;raster_path, __pyx_t_4};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_6)) {
    PyObject *__pyx_temp[3] = {__pyx_t_3, __pyx_v_self-&gt;raster_path, __pyx_t_4};
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_6, __pyx_temp+1-__pyx_t_8, 2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  {
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    if (__pyx_t_3) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_t_3); __pyx_t_3 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;raster_path);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;raster_path);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0+__pyx_t_8, __pyx_v_self-&gt;raster_path);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1+__pyx_t_8, __pyx_t_4);
    __pyx_t_4 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_6, __pyx_t_5, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 143, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_raster = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">145</span>:         <span class="n">raster_band</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_id</span><span class="p">)</span></pre>
<pre class='cython code score-19 '>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_raster, __pyx_n_s_GetRasterBand);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 145, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_self-&gt;band_id);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 145, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_4 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_6))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_6);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_6, function);
    }
  }
  __pyx_t_2 = (__pyx_t_4) ? __Pyx_PyObject_Call2Args(__pyx_t_6, __pyx_t_4, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_6, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_2)) <span class='error_goto'>__PYX_ERR(0, 145, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_v_raster_band = __pyx_t_2;
  __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">146</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">147</span>:         <span class="c"># if we get here, we&#39;re in write_mode</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">148</span>:         <span class="k">cdef</span> <span class="kt">cset</span>[<span class="kt">int</span>].<span class="kt">iterator</span> <span class="nf">dirty_itr</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">149</span>:         <span class="k">while</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">end</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  while (1) {
    __pyx_t_1 = ((__pyx_v_it != __pyx_v_end) != 0);
    if (!__pyx_t_1) break;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">150</span>:             <span class="n">double_buffer</span> <span class="o">=</span> <span class="n">deref</span><span class="p">(</span><span class="n">it</span><span class="p">)</span><span class="o">.</span><span class="n">second</span></pre>
<pre class='cython code score-0 '>    __pyx_t_9 = (*__pyx_v_it).second;
    __pyx_v_double_buffer = __pyx_t_9;
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">151</span>:             <span class="n">block_index</span> <span class="o">=</span> <span class="n">deref</span><span class="p">(</span><span class="n">it</span><span class="p">)</span><span class="o">.</span><span class="n">first</span></pre>
<pre class='cython code score-3 '>    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>((*__pyx_v_it).first);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 151, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_v_block_index, __pyx_t_2);
    __pyx_t_2 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">152</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">153</span>:             <span class="c"># write to disk if block is dirty</span></pre>
<pre class="cython line score-7" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">154</span>:             <span class="n">dirty_itr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirty_blocks</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span></pre>
<pre class='cython code score-7 '>    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_v_block_index); if (unlikely((__pyx_t_8 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 154, __pyx_L1_error)</span>
    __pyx_v_dirty_itr = __pyx_v_self-&gt;dirty_blocks.find(__pyx_t_8);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">155</span>:             <span class="k">if</span> <span class="n">dirty_itr</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirty_blocks</span><span class="o">.</span><span class="n">end</span><span class="p">():</span></pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_dirty_itr != __pyx_v_self-&gt;dirty_blocks.end()) != 0);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">156</span>:                 <span class="bp">self</span><span class="o">.</span><span class="n">dirty_blocks</span><span class="o">.</span><span class="n">erase</span><span class="p">(</span><span class="n">dirty_itr</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      (void)(__pyx_v_self-&gt;dirty_blocks.erase(__pyx_v_dirty_itr));
</pre><pre class="cython line score-16" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">157</span>:                 <span class="n">block_xi</span> <span class="o">=</span> <span class="n">block_index</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_nx</span></pre>
<pre class='cython code score-16 '>      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_self-&gt;block_nx);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 157, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      __pyx_t_6 = <span class='py_c_api'>PyNumber_Remainder</span>(__pyx_v_block_index, __pyx_t_2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 157, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_6); if (unlikely((__pyx_t_8 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 157, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_v_block_xi = __pyx_t_8;
</pre><pre class="cython line score-13" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">158</span>:                 <span class="n">block_yi</span> <span class="o">=</span> <span class="n">block_index</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_nx</span></pre>
<pre class='cython code score-13 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_self-&gt;block_nx);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyNumber_Divide</span>(__pyx_v_block_index, __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 158, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_2); if (unlikely((__pyx_t_8 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 158, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      __pyx_v_block_yi = __pyx_t_8;
</pre><pre class="cython line score-0">&#xA0;<span class="">159</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">160</span>:                 <span class="c"># we need the offsets to subtract from global indexes for</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">161</span>:                 <span class="c"># cached array</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">162</span>:                 <span class="n">xoff</span> <span class="o">=</span> <span class="n">block_xi</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xbits</span></pre>
<pre class='cython code score-0 '>      __pyx_v_xoff = (__pyx_v_block_xi &lt;&lt; __pyx_v_self-&gt;block_xbits);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">163</span>:                 <span class="n">yoff</span> <span class="o">=</span> <span class="n">block_yi</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_ybits</span></pre>
<pre class='cython code score-0 '>      __pyx_v_yoff = (__pyx_v_block_yi &lt;&lt; __pyx_v_self-&gt;block_ybits);
</pre><pre class="cython line score-0">&#xA0;<span class="">164</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">165</span>:                 <span class="n">win_xsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = __pyx_v_self-&gt;block_xsize;
      __pyx_v_win_xsize = __pyx_t_8;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">166</span>:                 <span class="n">win_ysize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = __pyx_v_self-&gt;block_ysize;
      __pyx_v_win_ysize = __pyx_t_8;
</pre><pre class="cython line score-0">&#xA0;<span class="">167</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">168</span>:                 <span class="c"># clip window sizes if necessary</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">169</span>:                 <span class="k">if</span> <span class="n">xoff</span><span class="o">+</span><span class="n">win_xsize</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_x_size</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_1 = (((__pyx_v_xoff + __pyx_v_win_xsize) &gt; __pyx_v_self-&gt;raster_x_size) != 0);
      if (__pyx_t_1) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">170</span>:                     <span class="n">win_xsize</span> <span class="o">=</span> <span class="n">win_xsize</span> <span class="o">-</span> <span class="p">(</span></pre>
<pre class='cython code score-0 '>        __pyx_v_win_xsize = (__pyx_v_win_xsize - ((__pyx_v_xoff + __pyx_v_win_xsize) - __pyx_v_self-&gt;raster_x_size));
</pre><pre class="cython line score-0">&#xA0;<span class="">171</span>:                         <span class="n">xoff</span><span class="o">+</span><span class="n">win_xsize</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_x_size</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">172</span>:                 <span class="k">if</span> <span class="n">yoff</span><span class="o">+</span><span class="n">win_ysize</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_y_size</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>      __pyx_t_1 = (((__pyx_v_yoff + __pyx_v_win_ysize) &gt; __pyx_v_self-&gt;raster_y_size) != 0);
      if (__pyx_t_1) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">173</span>:                     <span class="n">win_ysize</span> <span class="o">=</span> <span class="n">win_ysize</span> <span class="o">-</span> <span class="p">(</span></pre>
<pre class='cython code score-0 '>        __pyx_v_win_ysize = (__pyx_v_win_ysize - ((__pyx_v_yoff + __pyx_v_win_ysize) - __pyx_v_self-&gt;raster_y_size));
</pre><pre class="cython line score-0">&#xA0;<span class="">174</span>:                         <span class="n">yoff</span><span class="o">+</span><span class="n">win_ysize</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_y_size</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">175</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">176</span>:                 <span class="k">for</span> <span class="n">xi_copy</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">win_xsize</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>      __pyx_t_8 = __pyx_v_win_xsize;
      __pyx_t_10 = __pyx_t_8;
      for (__pyx_t_11 = 0; __pyx_t_11 &lt; __pyx_t_10; __pyx_t_11+=1) {
        __pyx_v_xi_copy = __pyx_t_11;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">177</span>:                     <span class="k">for</span> <span class="n">yi_copy</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">win_ysize</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>        __pyx_t_12 = __pyx_v_win_ysize;
        __pyx_t_13 = __pyx_t_12;
        for (__pyx_t_14 = 0; __pyx_t_14 &lt; __pyx_t_13; __pyx_t_14+=1) {
          __pyx_v_yi_copy = __pyx_t_14;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">178</span>:                         <span class="n">block_array</span><span class="p">[</span><span class="n">yi_copy</span><span class="p">,</span> <span class="n">xi_copy</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span></pre>
<pre class='cython code score-2 '>          __pyx_t_15 = __pyx_v_yi_copy;
          __pyx_t_16 = __pyx_v_xi_copy;
          __pyx_t_17 = -1;
          if (__pyx_t_15 &lt; 0) {
            __pyx_t_15 += __pyx_pybuffernd_block_array.diminfo[0].shape;
            if (unlikely(__pyx_t_15 &lt; 0)) __pyx_t_17 = 0;
          } else if (unlikely(__pyx_t_15 &gt;= __pyx_pybuffernd_block_array.diminfo[0].shape)) __pyx_t_17 = 0;
          if (__pyx_t_16 &lt; 0) {
            __pyx_t_16 += __pyx_pybuffernd_block_array.diminfo[1].shape;
            if (unlikely(__pyx_t_16 &lt; 0)) __pyx_t_17 = 1;
          } else if (unlikely(__pyx_t_16 &gt;= __pyx_pybuffernd_block_array.diminfo[1].shape)) __pyx_t_17 = 1;
          if (unlikely(__pyx_t_17 != -1)) {
            <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_17);
            <span class='error_goto'>__PYX_ERR(0, 178, __pyx_L1_error)</span>
          }
          *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.buf, __pyx_t_15, __pyx_pybuffernd_block_array.diminfo[0].strides, __pyx_t_16, __pyx_pybuffernd_block_array.diminfo[1].strides) = (__pyx_v_double_buffer[((__pyx_v_yi_copy &lt;&lt; __pyx_v_self-&gt;block_xbits) + __pyx_v_xi_copy)]);
        }
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">179</span>:                             <span class="n">double_buffer</span><span class="p">[</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">180</span>:                                 <span class="p">(</span><span class="n">yi_copy</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xbits</span><span class="p">)</span> <span class="o">+</span> <span class="n">xi_copy</span><span class="p">])</span></pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">181</span>:                 <span class="n">raster_band</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span></pre>
<pre class='cython code score-14 '>      __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_raster_band, __pyx_n_s_WriteArray);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 181, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
/* … */
      __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 181, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_4);
      __pyx_t_4 = 0;
/* … */
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_6, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 181, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">182</span>:                     <span class="n">block_array</span><span class="p">[</span><span class="mf">0</span><span class="p">:</span><span class="n">win_ysize</span><span class="p">,</span> <span class="mf">0</span><span class="p">:</span><span class="n">win_xsize</span><span class="p">],</span></pre>
<pre class='cython code score-26 '>      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_win_ysize);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_5 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_6, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_win_xsize);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_4 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_6, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
      __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1, __pyx_t_4);
      __pyx_t_5 = 0;
      __pyx_t_4 = 0;
      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_block_array), __pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 182, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">183</span>:                     <span class="n">xoff</span><span class="o">=</span><span class="n">xoff</span><span class="p">,</span> <span class="n">yoff</span><span class="o">=</span><span class="n">yoff</span><span class="p">)</span></pre>
<pre class='cython code score-18 '>      __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 183, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_xoff);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_xoff, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 183, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_yoff);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 183, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_4, __pyx_n_s_yoff, __pyx_t_5) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 183, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">184</span>:             <span class="n">PyMem_Free</span><span class="p">(</span><span class="n">double_buffer</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>    <span class='py_c_api'>PyMem_Free</span>(__pyx_v_double_buffer);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">185</span>:             <span class="n">inc</span><span class="p">(</span><span class="n">it</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    (void)((++__pyx_v_it));
  }
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">186</span>:         <span class="n">raster_band</span><span class="o">.</span><span class="n">FlushCache</span><span class="p">()</span></pre>
<pre class='cython code score-19 '>  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_raster_band, __pyx_n_s_FlushCache);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 186, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_4))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_4);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_4, function);
    }
  }
  __pyx_t_5 = (__pyx_t_6) ? <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_4, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallNoArg</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  if (unlikely(!__pyx_t_5)) <span class='error_goto'>__PYX_ERR(0, 186, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">187</span>:         <span class="n">raster_band</span> <span class="o">=</span> <span class="bp">None</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_raster_band, Py_None);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">188</span>:         <span class="n">raster</span> <span class="o">=</span> <span class="bp">None</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_raster, Py_None);
</pre><pre class="cython line score-0">&#xA0;<span class="">189</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">190</span>:     <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">void</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">long</span> <span class="n">xi</span><span class="p">,</span> <span class="nb">long</span> <span class="n">yi</span><span class="p">,</span> <span class="n">double</span> <span class="n">value</span><span class="p">):</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE void __pyx_f_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_set(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *__pyx_v_self, long __pyx_v_xi, long __pyx_v_yi, double __pyx_v_value) {
  int __pyx_v_block_xi;
  int __pyx_v_block_yi;
  int __pyx_v_block_index;
  std::set&lt;int&gt; ::iterator __pyx_v_dirty_itr;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("set", 0);
  <span class='trace'>__Pyx_TraceCall</span>("set", __pyx_f[0], 190, 0, <span class='error_goto'>__PYX_ERR(0, 190, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("natcap.invest.managed_raster.managed_raster._ManagedRaster.set", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-0">&#xA0;<span class="">191</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;Set the pixel at `xi,yi` to `value`.&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">192</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">block_xi</span> <span class="o">=</span> <span class="n">xi</span> <span class="o">&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xbits</span></pre>
<pre class='cython code score-0 '>  __pyx_v_block_xi = (__pyx_v_xi &gt;&gt; __pyx_v_self-&gt;block_xbits);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">193</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">block_yi</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_ybits</span></pre>
<pre class='cython code score-0 '>  __pyx_v_block_yi = (__pyx_v_yi &gt;&gt; __pyx_v_self-&gt;block_ybits);
</pre><pre class="cython line score-0">&#xA0;<span class="">194</span>:         <span class="c"># this is the flat index for the block</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">195</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">block_index</span> <span class="o">=</span> <span class="n">block_yi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_nx</span> <span class="o">+</span> <span class="n">block_xi</span></pre>
<pre class='cython code score-0 '>  __pyx_v_block_index = ((__pyx_v_block_yi * __pyx_v_self-&gt;block_nx) + __pyx_v_block_xi);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">196</span>:         <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lru_cache</span><span class="o">.</span><span class="n">exist</span><span class="p">(</span><span class="n">block_index</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((!(__pyx_v_self-&gt;lru_cache-&gt;exist(__pyx_v_block_index) != 0)) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">197</span>:             <span class="bp">self</span><span class="o">.</span><span class="n">_load_block</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_load_block(__pyx_v_self, __pyx_v_block_index);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 197, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">198</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">lru_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">199</span>:             <span class="n">block_index</span><span class="p">)[</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">200</span>:                 <span class="p">((</span><span class="n">yi</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_ymod</span><span class="p">))</span><span class="o">&lt;&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">block_xbits</span><span class="p">)</span> <span class="o">+</span></pre>
<pre class='cython code score-0 '>  (__pyx_v_self-&gt;lru_cache-&gt;get(__pyx_v_block_index)[(((__pyx_v_yi &amp; __pyx_v_self-&gt;block_ymod) &lt;&lt; __pyx_v_self-&gt;block_xbits) + (__pyx_v_xi &amp; __pyx_v_self-&gt;block_xmod))]) = __pyx_v_value;
</pre><pre class="cython line score-0">&#xA0;<span class="">201</span>:                 <span class="p">(</span><span class="n">xi</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_xmod</span><span class="p">))]</span> <span class="o">=</span> <span class="n">value</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">202</span>:         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_mode</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = (__pyx_v_self-&gt;write_mode != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">203</span>:             <span class="n">dirty_itr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirty_blocks</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_dirty_itr = __pyx_v_self-&gt;dirty_blocks.find(__pyx_v_block_index);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">204</span>:             <span class="k">if</span> <span class="n">dirty_itr</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirty_blocks</span><span class="o">.</span><span class="n">end</span><span class="p">():</span></pre>
<pre class='cython code score-0 '>    __pyx_t_1 = ((__pyx_v_dirty_itr == __pyx_v_self-&gt;dirty_blocks.end()) != 0);
    if (__pyx_t_1) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">205</span>:                 <span class="bp">self</span><span class="o">.</span><span class="n">dirty_blocks</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      try {
        __pyx_v_self-&gt;dirty_blocks.insert(__pyx_v_block_index);
      } catch(...) {
        __Pyx_CppExn2PyErr();
        <span class='error_goto'>__PYX_ERR(0, 205, __pyx_L1_error)</span>
      }
</pre><pre class="cython line score-0">&#xA0;<span class="">206</span>: </pre>
<pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">207</span>:     <span class="k">cdef</span> <span class="kr">inline</span> <span class="kt">double</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">long</span> <span class="n">xi</span><span class="p">,</span> <span class="nb">long</span> <span class="n">yi</span><span class="p">):</span></pre>
<pre class='cython code score-2 '>static CYTHON_INLINE double __pyx_f_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster_get(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *__pyx_v_self, long __pyx_v_xi, long __pyx_v_yi) {
  int __pyx_v_block_xi;
  int __pyx_v_block_yi;
  int __pyx_v_block_index;
  double __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("get", 0);
  <span class='trace'>__Pyx_TraceCall</span>("get", __pyx_f[0], 207, 0, <span class='error_goto'>__PYX_ERR(0, 207, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("natcap.invest.managed_raster.managed_raster._ManagedRaster.get", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">208</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;Return the value of the pixel at `xi,yi`.&quot;&quot;&quot;</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">209</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">block_xi</span> <span class="o">=</span> <span class="n">xi</span> <span class="o">&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xbits</span></pre>
<pre class='cython code score-0 '>  __pyx_v_block_xi = (__pyx_v_xi &gt;&gt; __pyx_v_self-&gt;block_xbits);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">210</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">block_yi</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">&gt;&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_ybits</span></pre>
<pre class='cython code score-0 '>  __pyx_v_block_yi = (__pyx_v_yi &gt;&gt; __pyx_v_self-&gt;block_ybits);
</pre><pre class="cython line score-0">&#xA0;<span class="">211</span>:         <span class="c"># this is the flat index for the block</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">212</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">block_index</span> <span class="o">=</span> <span class="n">block_yi</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_nx</span> <span class="o">+</span> <span class="n">block_xi</span></pre>
<pre class='cython code score-0 '>  __pyx_v_block_index = ((__pyx_v_block_yi * __pyx_v_self-&gt;block_nx) + __pyx_v_block_xi);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">213</span>:         <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">lru_cache</span><span class="o">.</span><span class="n">exist</span><span class="p">(</span><span class="n">block_index</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = ((!(__pyx_v_self-&gt;lru_cache-&gt;exist(__pyx_v_block_index) != 0)) != 0);
  if (__pyx_t_1) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">214</span>:             <span class="bp">self</span><span class="o">.</span><span class="n">_load_block</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    ((struct __pyx_vtabstruct_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *)__pyx_v_self-&gt;__pyx_vtab)-&gt;_load_block(__pyx_v_self, __pyx_v_block_index);<span class='error_goto'> if (unlikely(PyErr_Occurred())) __PYX_ERR(0, 214, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">215</span>:         <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">lru_cache</span><span class="o">.</span><span class="n">get</span><span class="p">(</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">216</span>:             <span class="n">block_index</span><span class="p">)[</span></pre>
<pre class='cython code score-0 '>  __pyx_r = (__pyx_v_self-&gt;lru_cache-&gt;get(__pyx_v_block_index)[(((__pyx_v_yi &amp; __pyx_v_self-&gt;block_ymod) &lt;&lt; __pyx_v_self-&gt;block_xbits) + (__pyx_v_xi &amp; __pyx_v_self-&gt;block_xmod))]);
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">217</span>:                 <span class="p">((</span><span class="n">yi</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_ymod</span><span class="p">))</span><span class="o">&lt;&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">block_xbits</span><span class="p">)</span> <span class="o">+</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">218</span>:                 <span class="p">(</span><span class="n">xi</span> <span class="o">&amp;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_xmod</span><span class="p">))]</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">219</span>: </pre>
<pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">220</span>:     <span class="k">cdef</span> <span class="kt">void</span> <span class="nf">_load_block</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">int</span> <span class="n">block_index</span><span class="p">)</span> <span class="k">except</span> <span class="o">*</span><span class="p">:</span></pre>
<pre class='cython code score-18 '>static void __pyx_f_6natcap_6invest_14managed_raster_14managed_raster_14_ManagedRaster__load_block(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *__pyx_v_self, int __pyx_v_block_index) {
  int __pyx_v_block_xi;
  int __pyx_v_block_yi;
  int __pyx_v_xoff;
  int __pyx_v_yoff;
  int __pyx_v_xi_copy;
  int __pyx_v_yi_copy;
  PyArrayObject *__pyx_v_block_array = 0;
  double *__pyx_v_double_buffer;
  std::list&lt;__pyx_t_6natcap_6invest_14managed_raster_14managed_raster_BlockBufferPair&gt;  __pyx_v_removed_value_list;
  int __pyx_v_win_xsize;
  int __pyx_v_win_ysize;
  PyObject *__pyx_v_raster = NULL;
  PyObject *__pyx_v_raster_band = NULL;
  std::set&lt;int&gt; ::iterator __pyx_v_dirty_itr;
  __Pyx_LocalBuf_ND __pyx_pybuffernd_block_array;
  __Pyx_Buffer __pyx_pybuffer_block_array;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("_load_block", 0);
  <span class='trace'>__Pyx_TraceCall</span>("_load_block", __pyx_f[0], 220, 0, <span class='error_goto'>__PYX_ERR(0, 220, __pyx_L1_error)</span>);
  __pyx_pybuffer_block_array.pybuffer.buf = NULL;
  __pyx_pybuffer_block_array.refcount = 0;
  __pyx_pybuffernd_block_array.data = NULL;
  __pyx_pybuffernd_block_array.rcbuffer = &amp;__pyx_pybuffer_block_array;
/* … */
  /* function exit code */
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  { PyObject *__pyx_type, *__pyx_value, *__pyx_tb;
    __Pyx_PyThreadState_declare
    __Pyx_PyThreadState_assign
    <span class='pyx_c_api'>__Pyx_ErrFetch</span>(&amp;__pyx_type, &amp;__pyx_value, &amp;__pyx_tb);
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer);
  <span class='pyx_c_api'>__Pyx_ErrRestore</span>(__pyx_type, __pyx_value, __pyx_tb);}
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("natcap.invest.managed_raster.managed_raster._ManagedRaster._load_block", __pyx_clineno, __pyx_lineno, __pyx_filename);
  goto __pyx_L2;
  __pyx_L0:;
  <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer);
  __pyx_L2:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>((PyObject *)__pyx_v_block_array);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_raster);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_raster_band);
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
}
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">221</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">block_xi</span> <span class="o">=</span> <span class="n">block_index</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_nx</span></pre>
<pre class='cython code score-5 '>  if (unlikely(__pyx_v_self-&gt;block_nx == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "integer division or modulo by zero");
    <span class='error_goto'>__PYX_ERR(0, 221, __pyx_L1_error)</span>
  }
  __pyx_v_block_xi = __Pyx_mod_int(__pyx_v_block_index, __pyx_v_self-&gt;block_nx);
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">222</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">block_yi</span> <span class="o">=</span> <span class="n">block_index</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_nx</span></pre>
<pre class='cython code score-10 '>  if (unlikely(__pyx_v_self-&gt;block_nx == 0)) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "integer division or modulo by zero");
    <span class='error_goto'>__PYX_ERR(0, 222, __pyx_L1_error)</span>
  }
  else if (sizeof(int) == sizeof(long) &amp;&amp; (!(((int)-1) &gt; 0)) &amp;&amp; unlikely(__pyx_v_self-&gt;block_nx == (int)-1)  &amp;&amp; unlikely(UNARY_NEG_WOULD_OVERFLOW(__pyx_v_block_index))) {
    <span class='py_c_api'>PyErr_SetString</span>(PyExc_OverflowError, "value too large to perform division");
    <span class='error_goto'>__PYX_ERR(0, 222, __pyx_L1_error)</span>
  }
  __pyx_v_block_yi = __Pyx_div_int(__pyx_v_block_index, __pyx_v_self-&gt;block_nx);
</pre><pre class="cython line score-0">&#xA0;<span class="">223</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">224</span>:         <span class="c"># we need the offsets to subtract from global indexes for cached array</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">225</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">xoff</span> <span class="o">=</span> <span class="n">block_xi</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xbits</span></pre>
<pre class='cython code score-0 '>  __pyx_v_xoff = (__pyx_v_block_xi &lt;&lt; __pyx_v_self-&gt;block_xbits);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">226</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">yoff</span> <span class="o">=</span> <span class="n">block_yi</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_ybits</span></pre>
<pre class='cython code score-0 '>  __pyx_v_yoff = (__pyx_v_block_yi &lt;&lt; __pyx_v_self-&gt;block_ybits);
</pre><pre class="cython line score-0">&#xA0;<span class="">227</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">228</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">xi_copy</span><span class="p">,</span> <span class="nf">yi_copy</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">229</span>:         <span class="k">cdef</span> <span class="kt">numpy</span>.<span class="kt">ndarray</span>[<span class="nf">double</span><span class="p">,</span> <span class="nf">ndim</span><span class="o">=</span><span class="mf">2</span><span class="p">]</span> <span class="n">block_array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">230</span>:         <span class="k">cdef</span> <span class="kt">double</span> *<span class="nf">double_buffer</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">231</span>:         <span class="k">cdef</span> <span class="kt">clist</span>[<span class="kt">BlockBufferPair</span>] <span class="nf">removed_value_list</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">232</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">233</span>:         <span class="c"># determine the block aligned xoffset for read as array</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">234</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">235</span>:         <span class="c"># initially the win size is the same as the block size unless</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">236</span>:         <span class="c"># we&#39;re at the edge of a raster</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">237</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">win_xsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_self-&gt;block_xsize;
  __pyx_v_win_xsize = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">238</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">win_ysize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_self-&gt;block_ysize;
  __pyx_v_win_ysize = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">239</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">240</span>:         <span class="c"># load a new block</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">241</span>:         <span class="k">if</span> <span class="n">xoff</span><span class="o">+</span><span class="n">win_xsize</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_x_size</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (((__pyx_v_xoff + __pyx_v_win_xsize) &gt; __pyx_v_self-&gt;raster_x_size) != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">242</span>:             <span class="n">win_xsize</span> <span class="o">=</span> <span class="n">win_xsize</span> <span class="o">-</span> <span class="p">(</span><span class="n">xoff</span><span class="o">+</span><span class="n">win_xsize</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_x_size</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_win_xsize = (__pyx_v_win_xsize - ((__pyx_v_xoff + __pyx_v_win_xsize) - __pyx_v_self-&gt;raster_x_size));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">243</span>:         <span class="k">if</span> <span class="n">yoff</span><span class="o">+</span><span class="n">win_ysize</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_y_size</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (((__pyx_v_yoff + __pyx_v_win_ysize) &gt; __pyx_v_self-&gt;raster_y_size) != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">244</span>:             <span class="n">win_ysize</span> <span class="o">=</span> <span class="n">win_ysize</span> <span class="o">-</span> <span class="p">(</span><span class="n">yoff</span><span class="o">+</span><span class="n">win_ysize</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_y_size</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_v_win_ysize = (__pyx_v_win_ysize - ((__pyx_v_yoff + __pyx_v_win_ysize) - __pyx_v_self-&gt;raster_y_size));
</pre><pre class="cython line score-0">&#xA0;<span class="">245</span>: </pre>
<pre class="cython line score-48" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">246</span>:         <span class="n">raster</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">OpenEx</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">raster_path</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">OF_RASTER</span><span class="p">)</span></pre>
<pre class='cython code score-48 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_gdal);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 246, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_OpenEx);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 246, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_4, __pyx_n_s_gdal);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 246, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_4, __pyx_n_s_OF_RASTER);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 246, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  __pyx_t_4 = NULL;
  __pyx_t_1 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_4)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      __pyx_t_1 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_self-&gt;raster_path, __pyx_t_6};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_1, 2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 246, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
    PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_self-&gt;raster_path, __pyx_t_6};
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_1, 2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 246, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  } else
  #endif
  {
    __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 246, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    if (__pyx_t_4) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_4); __pyx_t_4 = NULL;
    }
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;raster_path);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;raster_path);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+__pyx_t_1, __pyx_v_self-&gt;raster_path);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1+__pyx_t_1, __pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 246, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_raster = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class="cython line score-19" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">247</span>:         <span class="n">raster_band</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_id</span><span class="p">)</span></pre>
<pre class='cython code score-19 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_raster, __pyx_n_s_GetRasterBand);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 247, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_self-&gt;band_id);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 247, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
    }
  }
  __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_6, __pyx_t_7) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 247, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  __pyx_v_raster_band = __pyx_t_3;
  __pyx_t_3 = 0;
</pre><pre class="cython line score-6" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">248</span>:         <span class="n">block_array</span> <span class="o">=</span> <span class="n">raster_band</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">(</span></pre>
<pre class='cython code score-6 '>  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_raster_band, __pyx_n_s_ReadAsArray);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
/* … */
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_empty_tuple, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 248, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">249</span>:             <span class="n">xoff</span><span class="o">=</span><span class="n">xoff</span><span class="p">,</span> <span class="n">yoff</span><span class="o">=</span><span class="n">yoff</span><span class="p">,</span> <span class="n">win_xsize</span><span class="o">=</span><span class="n">win_xsize</span><span class="p">,</span></pre>
<pre class='cython code score-26 '>  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_xoff);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_7, __pyx_n_s_xoff, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 249, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_yoff);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_7, __pyx_n_s_yoff, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 249, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_win_xsize);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 249, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_7, __pyx_n_s_win_xsize, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 249, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-31" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">250</span>:             <span class="n">win_ysize</span><span class="o">=</span><span class="n">win_ysize</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span></pre>
<pre class='cython code score-31 '>  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_win_ysize);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_7, __pyx_n_s_win_ysize, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 249, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_astype);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
/* … */
  if (!(likely(((__pyx_t_3) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_3, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 250, __pyx_L1_error)</span>
  __pyx_t_8 = ((PyArrayObject *)__pyx_t_3);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_8, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_1 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_9, &amp;__pyx_t_10, &amp;__pyx_t_11);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_block_array, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_9); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_11);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_9, __pyx_t_10, __pyx_t_11);
      }
      __pyx_t_9 = __pyx_t_10 = __pyx_t_11 = 0;
    }
    __pyx_pybuffernd_block_array.diminfo[0].strides = __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_block_array.diminfo[0].shape = __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_block_array.diminfo[1].strides = __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_block_array.diminfo[1].shape = __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 248, __pyx_L1_error)</span>
  }
  __pyx_t_8 = 0;
  __pyx_v_block_array = ((PyArrayObject *)__pyx_t_3);
  __pyx_t_3 = 0;
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">251</span>:             <span class="n">numpy</span><span class="o">.</span><span class="n">float64</span><span class="p">)</span></pre>
<pre class='cython code score-20 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_6, __pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 251, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_6, __pyx_n_s_float64);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 251, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  __pyx_t_6 = NULL;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_7))) {
    __pyx_t_6 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_7);
    if (likely(__pyx_t_6)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_7, function);
    }
  }
  __pyx_t_3 = (__pyx_t_6) ? __Pyx_PyObject_Call2Args(__pyx_t_7, __pyx_t_6, __pyx_t_5) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_7, __pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 250, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">252</span>:         <span class="n">raster_band</span> <span class="o">=</span> <span class="bp">None</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_raster_band, Py_None);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">253</span>:         <span class="n">raster</span> <span class="o">=</span> <span class="bp">None</span></pre>
<pre class='cython code score-2 '>  <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_raster, Py_None);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">254</span>:         <span class="n">double_buffer</span> <span class="o">=</span> <span class="o">&lt;</span><span class="n">double</span><span class="o">*&gt;</span><span class="n">PyMem_Malloc</span><span class="p">(</span></pre>
<pre class='cython code score-5 '>  __pyx_v_double_buffer = ((double *)<span class='py_c_api'>PyMem_Malloc</span>((((sizeof(double)) &lt;&lt; __pyx_v_self-&gt;block_xbits) * __pyx_v_win_ysize)));
</pre><pre class="cython line score-0">&#xA0;<span class="">255</span>:             <span class="p">(</span><span class="n">sizeof</span><span class="p">(</span><span class="n">double</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xbits</span><span class="p">)</span> <span class="o">*</span> <span class="n">win_ysize</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">256</span>:         <span class="k">for</span> <span class="n">xi_copy</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">win_xsize</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  __pyx_t_1 = __pyx_v_win_xsize;
  __pyx_t_12 = __pyx_t_1;
  for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_12; __pyx_t_13+=1) {
    __pyx_v_xi_copy = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">257</span>:             <span class="k">for</span> <span class="n">yi_copy</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">win_ysize</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_14 = __pyx_v_win_ysize;
    __pyx_t_15 = __pyx_t_14;
    for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_15; __pyx_t_16+=1) {
      __pyx_v_yi_copy = __pyx_t_16;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">258</span>:                 <span class="n">double_buffer</span><span class="p">[(</span><span class="n">yi_copy</span><span class="o">&lt;&lt;</span><span class="bp">self</span><span class="o">.</span><span class="n">block_xbits</span><span class="p">)</span><span class="o">+</span><span class="n">xi_copy</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span></pre>
<pre class='cython code score-0 '>      (__pyx_v_double_buffer[((__pyx_v_yi_copy &lt;&lt; __pyx_v_self-&gt;block_xbits) + __pyx_v_xi_copy)]) = (*__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.buf, __pyx_t_17, __pyx_pybuffernd_block_array.diminfo[0].strides, __pyx_t_18, __pyx_pybuffernd_block_array.diminfo[1].strides));
    }
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">259</span>:                     <span class="n">block_array</span><span class="p">[</span><span class="n">yi_copy</span><span class="p">,</span> <span class="n">xi_copy</span><span class="p">])</span></pre>
<pre class='cython code score-2 '>      __pyx_t_17 = __pyx_v_yi_copy;
      __pyx_t_18 = __pyx_v_xi_copy;
      __pyx_t_19 = -1;
      if (__pyx_t_17 &lt; 0) {
        __pyx_t_17 += __pyx_pybuffernd_block_array.diminfo[0].shape;
        if (unlikely(__pyx_t_17 &lt; 0)) __pyx_t_19 = 0;
      } else if (unlikely(__pyx_t_17 &gt;= __pyx_pybuffernd_block_array.diminfo[0].shape)) __pyx_t_19 = 0;
      if (__pyx_t_18 &lt; 0) {
        __pyx_t_18 += __pyx_pybuffernd_block_array.diminfo[1].shape;
        if (unlikely(__pyx_t_18 &lt; 0)) __pyx_t_19 = 1;
      } else if (unlikely(__pyx_t_18 &gt;= __pyx_pybuffernd_block_array.diminfo[1].shape)) __pyx_t_19 = 1;
      if (unlikely(__pyx_t_19 != -1)) {
        <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_19);
        <span class='error_goto'>__PYX_ERR(0, 259, __pyx_L1_error)</span>
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">260</span>:         <span class="bp">self</span><span class="o">.</span><span class="n">lru_cache</span><span class="o">.</span><span class="n">put</span><span class="p">(</span></pre>
<pre class='cython code score-0 '>  __pyx_v_self-&gt;lru_cache-&gt;put(((int)__pyx_v_block_index), ((double *)__pyx_v_double_buffer), __pyx_v_removed_value_list);
</pre><pre class="cython line score-0">&#xA0;<span class="">261</span>:             <span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span><span class="n">block_index</span><span class="p">,</span> <span class="o">&lt;</span><span class="n">double</span><span class="o">*&gt;</span><span class="n">double_buffer</span><span class="p">,</span> <span class="n">removed_value_list</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">262</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">263</span>:         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_mode</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (__pyx_v_self-&gt;write_mode != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">264</span>:             <span class="n">raster</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">OpenEx</span><span class="p">(</span></pre>
<pre class='cython code score-5 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_gdal);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 264, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_OpenEx);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 264, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-56" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">265</span>:                 <span class="bp">self</span><span class="o">.</span><span class="n">raster_path</span><span class="p">,</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GA_Update</span> <span class="o">|</span> <span class="n">gdal</span><span class="o">.</span><span class="n">OF_RASTER</span><span class="p">)</span></pre>
<pre class='cython code score-56 '>    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_gdal);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_GA_Update);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_7, __pyx_n_s_gdal);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_7, __pyx_n_s_OF_RASTER);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_7 = <span class='py_c_api'>PyNumber_Or</span>(__pyx_t_6, __pyx_t_4);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 265, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_t_4 = NULL;
    __pyx_t_1 = 0;
    if (CYTHON_UNPACK_METHODS &amp;&amp; unlikely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
      __pyx_t_4 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
      if (likely(__pyx_t_4)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_4);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
        __pyx_t_1 = 1;
      }
    }
    #if CYTHON_FAST_PYCALL
    if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_self-&gt;raster_path, __pyx_t_7};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_1, 2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 264, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    } else
    #endif
    #if CYTHON_FAST_PYCCALL
    if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_5)) {
      PyObject *__pyx_temp[3] = {__pyx_t_4, __pyx_v_self-&gt;raster_path, __pyx_t_7};
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_5, __pyx_temp+1-__pyx_t_1, 2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 264, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    } else
    #endif
    {
      __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 264, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      if (__pyx_t_4) {
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_4); __pyx_t_4 = NULL;
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_v_self-&gt;raster_path);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_v_self-&gt;raster_path);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0+__pyx_t_1, __pyx_v_self-&gt;raster_path);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 1+__pyx_t_1, __pyx_t_7);
      __pyx_t_7 = 0;
      __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_6, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 264, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    }
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_raster, __pyx_t_3);
    __pyx_t_3 = 0;
</pre><pre class="cython line score-20" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">266</span>:             <span class="n">raster_band</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">band_id</span><span class="p">)</span></pre>
<pre class='cython code score-20 '>    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_raster, __pyx_n_s_GetRasterBand);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 266, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_self-&gt;band_id);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 266, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
    __pyx_t_7 = NULL;
    if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_5))) {
      __pyx_t_7 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_5);
      if (likely(__pyx_t_7)) {
        PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
        <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
        <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_5, function);
      }
    }
    __pyx_t_3 = (__pyx_t_7) ? __Pyx_PyObject_Call2Args(__pyx_t_5, __pyx_t_7, __pyx_t_6) : <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_t_5, __pyx_t_6);
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
    if (unlikely(!__pyx_t_3)) <span class='error_goto'>__PYX_ERR(0, 266, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_raster_band, __pyx_t_3);
    __pyx_t_3 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">267</span>: </pre>
<pre class="cython line score-37" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">268</span>:         <span class="n">block_array</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span></pre>
<pre class='cython code score-37 '>  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 268, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_empty);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 268, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
/* … */
  __pyx_t_6 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 268, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_6, 0, __pyx_t_7);
  __pyx_t_7 = 0;
/* … */
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_5, __pyx_t_6, __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 268, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  if (!(likely(((__pyx_t_4) == Py_None) || likely(<span class='pyx_c_api'>__Pyx_TypeTest</span>(__pyx_t_4, __pyx_ptype_5numpy_ndarray))))) <span class='error_goto'>__PYX_ERR(0, 268, __pyx_L1_error)</span>
  __pyx_t_8 = ((PyArrayObject *)__pyx_t_4);
  {
    __Pyx_BufFmt_StackElem __pyx_stack[1];
    <span class='pyx_c_api'>__Pyx_SafeReleaseBuffer</span>(&amp;__pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer);
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_t_8, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack);
    if (unlikely(__pyx_t_1 &lt; 0)) {
      <span class='py_c_api'>PyErr_Fetch</span>(&amp;__pyx_t_11, &amp;__pyx_t_10, &amp;__pyx_t_9);
      if (unlikely(<span class='pyx_c_api'>__Pyx_GetBufferAndValidate</span>(&amp;__pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer, (PyObject*)__pyx_v_block_array, &amp;__Pyx_TypeInfo_double, PyBUF_FORMAT| PyBUF_STRIDES| PyBUF_WRITABLE, 2, 0, __pyx_stack) == -1)) {
        Py_XDECREF(__pyx_t_11); Py_XDECREF(__pyx_t_10); Py_XDECREF(__pyx_t_9);
        <span class='pyx_c_api'>__Pyx_RaiseBufferFallbackError</span>();
      } else {
        <span class='py_c_api'>PyErr_Restore</span>(__pyx_t_11, __pyx_t_10, __pyx_t_9);
      }
      __pyx_t_11 = __pyx_t_10 = __pyx_t_9 = 0;
    }
    __pyx_pybuffernd_block_array.diminfo[0].strides = __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.strides[0]; __pyx_pybuffernd_block_array.diminfo[0].shape = __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.shape[0]; __pyx_pybuffernd_block_array.diminfo[1].strides = __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.strides[1]; __pyx_pybuffernd_block_array.diminfo[1].shape = __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.shape[1];
    if (unlikely(__pyx_t_1 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 268, __pyx_L1_error)</span>
  }
  __pyx_t_8 = 0;
  <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_block_array, ((PyArrayObject *)__pyx_t_4));
  __pyx_t_4 = 0;
</pre><pre class="cython line score-24" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">269</span>:             <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">double</span><span class="p">)</span></pre>
<pre class='cython code score-24 '>  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_self-&gt;block_ysize);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 269, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_self-&gt;block_xsize);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 269, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
  __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 269, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_3);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
  <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1, __pyx_t_6);
  __pyx_t_3 = 0;
  __pyx_t_6 = 0;
/* … */
  __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 269, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_GetModuleGlobalName</span>(__pyx_t_3, __pyx_n_s_numpy);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 269, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_t_3, __pyx_n_s_double);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 269, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
  if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_7, __pyx_n_s_dtype, __pyx_t_4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 269, __pyx_L1_error)</span>
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">270</span>:         <span class="k">while</span> <span class="ow">not</span> <span class="n">removed_value_list</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span></pre>
<pre class='cython code score-0 '>  while (1) {
    __pyx_t_2 = ((!(__pyx_v_removed_value_list.empty() != 0)) != 0);
    if (!__pyx_t_2) break;
</pre><pre class="cython line score-0">&#xA0;<span class="">271</span>:             <span class="c"># write the changed value back if desired</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">272</span>:             <span class="n">double_buffer</span> <span class="o">=</span> <span class="n">removed_value_list</span><span class="o">.</span><span class="n">front</span><span class="p">()</span><span class="o">.</span><span class="n">second</span></pre>
<pre class='cython code score-0 '>    __pyx_t_20 = __pyx_v_removed_value_list.front().second;
    __pyx_v_double_buffer = __pyx_t_20;
</pre><pre class="cython line score-0">&#xA0;<span class="">273</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">274</span>:             <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_mode</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_2 = (__pyx_v_self-&gt;write_mode != 0);
    if (__pyx_t_2) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">275</span>:                 <span class="n">block_index</span> <span class="o">=</span> <span class="n">removed_value_list</span><span class="o">.</span><span class="n">front</span><span class="p">()</span><span class="o">.</span><span class="n">first</span></pre>
<pre class='cython code score-0 '>      __pyx_t_1 = __pyx_v_removed_value_list.front().first;
      __pyx_v_block_index = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">276</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">277</span>:                 <span class="c"># write back the block if it&#39;s dirty</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">278</span>:                 <span class="n">dirty_itr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirty_blocks</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">block_index</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>      __pyx_v_dirty_itr = __pyx_v_self-&gt;dirty_blocks.find(__pyx_v_block_index);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">279</span>:                 <span class="k">if</span> <span class="n">dirty_itr</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dirty_blocks</span><span class="o">.</span><span class="n">end</span><span class="p">():</span></pre>
<pre class='cython code score-0 '>      __pyx_t_2 = ((__pyx_v_dirty_itr != __pyx_v_self-&gt;dirty_blocks.end()) != 0);
      if (__pyx_t_2) {
/* … */
      }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">280</span>:                     <span class="bp">self</span><span class="o">.</span><span class="n">dirty_blocks</span><span class="o">.</span><span class="n">erase</span><span class="p">(</span><span class="n">dirty_itr</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>        (void)(__pyx_v_self-&gt;dirty_blocks.erase(__pyx_v_dirty_itr));
</pre><pre class="cython line score-0">&#xA0;<span class="">281</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">282</span>:                     <span class="n">block_xi</span> <span class="o">=</span> <span class="n">block_index</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_nx</span></pre>
<pre class='cython code score-5 '>        if (unlikely(__pyx_v_self-&gt;block_nx == 0)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "integer division or modulo by zero");
          <span class='error_goto'>__PYX_ERR(0, 282, __pyx_L1_error)</span>
        }
        __pyx_v_block_xi = __Pyx_mod_int(__pyx_v_block_index, __pyx_v_self-&gt;block_nx);
</pre><pre class="cython line score-10" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">283</span>:                     <span class="n">block_yi</span> <span class="o">=</span> <span class="n">block_index</span> <span class="o">//</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_nx</span></pre>
<pre class='cython code score-10 '>        if (unlikely(__pyx_v_self-&gt;block_nx == 0)) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "integer division or modulo by zero");
          <span class='error_goto'>__PYX_ERR(0, 283, __pyx_L1_error)</span>
        }
        else if (sizeof(int) == sizeof(long) &amp;&amp; (!(((int)-1) &gt; 0)) &amp;&amp; unlikely(__pyx_v_self-&gt;block_nx == (int)-1)  &amp;&amp; unlikely(UNARY_NEG_WOULD_OVERFLOW(__pyx_v_block_index))) {
          <span class='py_c_api'>PyErr_SetString</span>(PyExc_OverflowError, "value too large to perform division");
          <span class='error_goto'>__PYX_ERR(0, 283, __pyx_L1_error)</span>
        }
        __pyx_v_block_yi = __Pyx_div_int(__pyx_v_block_index, __pyx_v_self-&gt;block_nx);
</pre><pre class="cython line score-0">&#xA0;<span class="">284</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">285</span>:                     <span class="n">xoff</span> <span class="o">=</span> <span class="n">block_xi</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xbits</span></pre>
<pre class='cython code score-0 '>        __pyx_v_xoff = (__pyx_v_block_xi &lt;&lt; __pyx_v_self-&gt;block_xbits);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">286</span>:                     <span class="n">yoff</span> <span class="o">=</span> <span class="n">block_yi</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_ybits</span></pre>
<pre class='cython code score-0 '>        __pyx_v_yoff = (__pyx_v_block_yi &lt;&lt; __pyx_v_self-&gt;block_ybits);
</pre><pre class="cython line score-0">&#xA0;<span class="">287</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">288</span>:                     <span class="n">win_xsize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xsize</span></pre>
<pre class='cython code score-0 '>        __pyx_t_1 = __pyx_v_self-&gt;block_xsize;
        __pyx_v_win_xsize = __pyx_t_1;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">289</span>:                     <span class="n">win_ysize</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_ysize</span></pre>
<pre class='cython code score-0 '>        __pyx_t_1 = __pyx_v_self-&gt;block_ysize;
        __pyx_v_win_ysize = __pyx_t_1;
</pre><pre class="cython line score-0">&#xA0;<span class="">290</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">291</span>:                     <span class="k">if</span> <span class="n">xoff</span><span class="o">+</span><span class="n">win_xsize</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_x_size</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_2 = (((__pyx_v_xoff + __pyx_v_win_xsize) &gt; __pyx_v_self-&gt;raster_x_size) != 0);
        if (__pyx_t_2) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">292</span>:                         <span class="n">win_xsize</span> <span class="o">=</span> <span class="n">win_xsize</span> <span class="o">-</span> <span class="p">(</span></pre>
<pre class='cython code score-0 '>          __pyx_v_win_xsize = (__pyx_v_win_xsize - ((__pyx_v_xoff + __pyx_v_win_xsize) - __pyx_v_self-&gt;raster_x_size));
</pre><pre class="cython line score-0">&#xA0;<span class="">293</span>:                             <span class="n">xoff</span><span class="o">+</span><span class="n">win_xsize</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_x_size</span><span class="p">)</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">294</span>:                     <span class="k">if</span> <span class="n">yoff</span><span class="o">+</span><span class="n">win_ysize</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_y_size</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>        __pyx_t_2 = (((__pyx_v_yoff + __pyx_v_win_ysize) &gt; __pyx_v_self-&gt;raster_y_size) != 0);
        if (__pyx_t_2) {
/* … */
        }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">295</span>:                         <span class="n">win_ysize</span> <span class="o">=</span> <span class="n">win_ysize</span> <span class="o">-</span> <span class="p">(</span></pre>
<pre class='cython code score-0 '>          __pyx_v_win_ysize = (__pyx_v_win_ysize - ((__pyx_v_yoff + __pyx_v_win_ysize) - __pyx_v_self-&gt;raster_y_size));
</pre><pre class="cython line score-0">&#xA0;<span class="">296</span>:                             <span class="n">yoff</span><span class="o">+</span><span class="n">win_ysize</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_y_size</span><span class="p">)</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">297</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">298</span>:                     <span class="k">for</span> <span class="n">xi_copy</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">win_xsize</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>        __pyx_t_1 = __pyx_v_win_xsize;
        __pyx_t_12 = __pyx_t_1;
        for (__pyx_t_13 = 0; __pyx_t_13 &lt; __pyx_t_12; __pyx_t_13+=1) {
          __pyx_v_xi_copy = __pyx_t_13;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">299</span>:                         <span class="k">for</span> <span class="n">yi_copy</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="n">win_ysize</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>          __pyx_t_14 = __pyx_v_win_ysize;
          __pyx_t_15 = __pyx_t_14;
          for (__pyx_t_16 = 0; __pyx_t_16 &lt; __pyx_t_15; __pyx_t_16+=1) {
            __pyx_v_yi_copy = __pyx_t_16;
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">300</span>:                             <span class="n">block_array</span><span class="p">[</span><span class="n">yi_copy</span><span class="p">,</span> <span class="n">xi_copy</span><span class="p">]</span> <span class="o">=</span> <span class="n">double_buffer</span><span class="p">[</span></pre>
<pre class='cython code score-2 '>            __pyx_t_18 = __pyx_v_yi_copy;
            __pyx_t_17 = __pyx_v_xi_copy;
            __pyx_t_19 = -1;
            if (__pyx_t_18 &lt; 0) {
              __pyx_t_18 += __pyx_pybuffernd_block_array.diminfo[0].shape;
              if (unlikely(__pyx_t_18 &lt; 0)) __pyx_t_19 = 0;
            } else if (unlikely(__pyx_t_18 &gt;= __pyx_pybuffernd_block_array.diminfo[0].shape)) __pyx_t_19 = 0;
            if (__pyx_t_17 &lt; 0) {
              __pyx_t_17 += __pyx_pybuffernd_block_array.diminfo[1].shape;
              if (unlikely(__pyx_t_17 &lt; 0)) __pyx_t_19 = 1;
            } else if (unlikely(__pyx_t_17 &gt;= __pyx_pybuffernd_block_array.diminfo[1].shape)) __pyx_t_19 = 1;
            if (unlikely(__pyx_t_19 != -1)) {
              <span class='pyx_c_api'>__Pyx_RaiseBufferIndexError</span>(__pyx_t_19);
              <span class='error_goto'>__PYX_ERR(0, 300, __pyx_L1_error)</span>
            }
            *__Pyx_BufPtrStrided2d(double *, __pyx_pybuffernd_block_array.rcbuffer-&gt;pybuffer.buf, __pyx_t_18, __pyx_pybuffernd_block_array.diminfo[0].strides, __pyx_t_17, __pyx_pybuffernd_block_array.diminfo[1].strides) = (__pyx_v_double_buffer[((__pyx_v_yi_copy &lt;&lt; __pyx_v_self-&gt;block_xbits) + __pyx_v_xi_copy)]);
          }
        }
</pre><pre class="cython line score-0">&#xA0;<span class="">301</span>:                                 <span class="p">(</span><span class="n">yi_copy</span> <span class="o">&lt;&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">block_xbits</span><span class="p">)</span> <span class="o">+</span> <span class="n">xi_copy</span><span class="p">]</span></pre>
<pre class="cython line score-14" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">302</span>:                     <span class="n">raster_band</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span></pre>
<pre class='cython code score-14 '>        __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(__pyx_v_raster_band, __pyx_n_s_WriteArray);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
/* … */
        __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(1);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_5);
        __pyx_t_5 = 0;
/* … */
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_4, __pyx_t_7, __pyx_t_5);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 302, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-26" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">303</span>:                         <span class="n">block_array</span><span class="p">[</span><span class="mf">0</span><span class="p">:</span><span class="n">win_ysize</span><span class="p">,</span> <span class="mf">0</span><span class="p">:</span><span class="n">win_xsize</span><span class="p">],</span></pre>
<pre class='cython code score-26 '>        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_win_ysize);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 303, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        __pyx_t_6 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_7, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 303, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_win_xsize);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 303, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        __pyx_t_5 = <span class='py_c_api'>PySlice_New</span>(__pyx_int_0, __pyx_t_7, Py_None);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 303, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
        __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 303, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_6);
        <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
        <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1, __pyx_t_5);
        __pyx_t_6 = 0;
        __pyx_t_5 = 0;
        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_GetItem</span>(((PyObject *)__pyx_v_block_array), __pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 303, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">304</span>:                         <span class="n">xoff</span><span class="o">=</span><span class="n">xoff</span><span class="p">,</span> <span class="n">yoff</span><span class="o">=</span><span class="n">yoff</span><span class="p">)</span></pre>
<pre class='cython code score-18 '>        __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyDict_NewPresized</span>(2);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 304, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_xoff);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 304, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_xoff, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 304, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
        __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_v_yoff);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 304, __pyx_L1_error)</span>
        <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
        if (<span class='py_c_api'>PyDict_SetItem</span>(__pyx_t_5, __pyx_n_s_yoff, __pyx_t_6) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 304, __pyx_L1_error)</span>
        <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_6); __pyx_t_6 = 0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">305</span>:             <span class="n">PyMem_Free</span><span class="p">(</span><span class="n">double_buffer</span><span class="p">)</span></pre>
<pre class='cython code score-5 '>    <span class='py_c_api'>PyMem_Free</span>(__pyx_v_double_buffer);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">306</span>:             <span class="n">removed_value_list</span><span class="o">.</span><span class="n">pop_front</span><span class="p">()</span></pre>
<pre class='cython code score-0 '>    __pyx_v_removed_value_list.pop_front();
  }
</pre><pre class="cython line score-0">&#xA0;<span class="">307</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">308</span>:         <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">write_mode</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>  __pyx_t_2 = (__pyx_v_self-&gt;write_mode != 0);
  if (__pyx_t_2) {
/* … */
  }
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">309</span>:             <span class="n">raster_band</span> <span class="o">=</span> <span class="bp">None</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_raster_band, Py_None);
</pre><pre class="cython line score-2" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">310</span>:             <span class="n">raster</span> <span class="o">=</span> <span class="bp">None</span></pre>
<pre class='cython code score-2 '>    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_v_raster, Py_None);
</pre><pre class="cython line score-0">&#xA0;<span class="">311</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">312</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">313</span>: <span class="k">cdef</span> <span class="k">class</span> <span class="nf">ManagedFlowDirRaster</span><span class="p">(</span><span class="n">_ManagedRaster</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>struct __pyx_vtabstruct_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster {
  struct __pyx_vtabstruct_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster __pyx_base;
  int (*is_local_high_point)(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *, long, long);
};
static struct __pyx_vtabstruct_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *__pyx_vtabptr_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster;
</pre><pre class="cython line score-0">&#xA0;<span class="">314</span>: </pre>
<pre class="cython line score-38" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">315</span>:     <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raster_path</span><span class="p">,</span> <span class="n">band_id</span><span class="p">,</span> <span class="n">write_mode</span><span class="p">,</span> <span class="n">flow_dir_type</span><span class="p">):</span></pre>
<pre class='cython code score-38 '>/* Python wrapper */
static int __pyx_pw_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static int __pyx_pw_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_1__init__(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  CYTHON_UNUSED PyObject *__pyx_v_raster_path = 0;
  CYTHON_UNUSED PyObject *__pyx_v_band_id = 0;
  CYTHON_UNUSED PyObject *__pyx_v_write_mode = 0;
  CYTHON_UNUSED PyObject *__pyx_v_flow_dir_type = 0;
  int __pyx_r;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__ (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_raster_path,&amp;__pyx_n_s_band_id,&amp;__pyx_n_s_write_mode,&amp;__pyx_n_s_flow_dir_type,0};
    PyObject* values[4] = {0,0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  4: values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
        CYTHON_FALLTHROUGH;
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_raster_path)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_band_id)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 4, 4, 1); <span class='error_goto'>__PYX_ERR(0, 315, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (likely((values[2] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_write_mode)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 4, 4, 2); <span class='error_goto'>__PYX_ERR(0, 315, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  3:
        if (likely((values[3] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_flow_dir_type)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 4, 4, 3); <span class='error_goto'>__PYX_ERR(0, 315, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "__init__") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 315, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 4) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
      values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
      values[3] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 3);
    }
    __pyx_v_raster_path = values[0];
    __pyx_v_band_id = values[1];
    __pyx_v_write_mode = values[2];
    __pyx_v_flow_dir_type = values[3];
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("__init__", 1, 4, 4, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 315, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("natcap.invest.managed_raster.managed_raster.ManagedFlowDirRaster.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return -1;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster___init__(((struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *)__pyx_v_self), __pyx_v_raster_path, __pyx_v_band_id, __pyx_v_write_mode, __pyx_v_flow_dir_type);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static int __pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster___init__(CYTHON_UNUSED struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *__pyx_v_self, CYTHON_UNUSED PyObject *__pyx_v_raster_path, CYTHON_UNUSED PyObject *__pyx_v_band_id, CYTHON_UNUSED PyObject *__pyx_v_write_mode, CYTHON_UNUSED PyObject *__pyx_v_flow_dir_type) {
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("__init__", 0);
  <span class='trace'>__Pyx_TraceCall</span>("__init__", __pyx_f[0], 315, 0, <span class='error_goto'>__PYX_ERR(0, 315, __pyx_L1_error)</span>);

  /* function exit code */
  __pyx_r = 0;
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("natcap.invest.managed_raster.managed_raster.ManagedFlowDirRaster.__init__", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = -1;
  __pyx_L0:;
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
</pre><pre class="cython line score-0">&#xA0;<span class="">316</span>:         <span class="k">pass</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">317</span>: </pre>
<pre class="cython line score-9" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">318</span>:     <span class="k">cdef</span> <span class="kt">bint</span> <span class="nf">is_local_high_point</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">long</span> <span class="n">xi</span><span class="p">,</span> <span class="nb">long</span> <span class="n">yi</span><span class="p">):</span></pre>
<pre class='cython code score-9 '>static int __pyx_f_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_is_local_high_point(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *__pyx_v_self, long __pyx_v_xi, long __pyx_v_yi) {
  PyObject *__pyx_v_ns = NULL;
  int __pyx_r;
  <span class='trace'>__Pyx_TraceDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("is_local_high_point", 0);
  <span class='trace'>__Pyx_TraceCall</span>("is_local_high_point", __pyx_f[0], 318, 0, <span class='error_goto'>__PYX_ERR(0, 318, __pyx_L1_error)</span>);
/* … */
  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_c_api'>__Pyx_WriteUnraisable</span>("natcap.invest.managed_raster.managed_raster.ManagedFlowDirRaster.is_local_high_point", __pyx_clineno, __pyx_lineno, __pyx_filename, 1, 0);
  __pyx_r = 0;
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_v_ns);
  <span class='trace'>__Pyx_TraceReturn</span>(Py_None, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
static PyObject *__pyx_gb_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_4generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
</pre><pre class="cython line score-0">&#xA0;<span class="">319</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if a given pixel is a local high point.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">320</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">321</span>: <span class="sd">        Args:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">322</span>: <span class="sd">            xi (int): x coordinate of the pixel to consider</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">323</span>: <span class="sd">            yi (int): y coordinate of the pixel to consider</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">324</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">325</span>: <span class="sd">        Returns:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">326</span>: <span class="sd">            True if the pixel is a local high point, i.e. it has no</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">327</span>: <span class="sd">            upslope neighbors; False otherwise.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">328</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-51" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">329</span>:         <span class="n">ns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">yield_upslope_neighbors</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">))</span></pre>
<pre class='cython code score-51 '>  __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyObject_GetAttrStr</span>(((PyObject *)__pyx_v_self), __pyx_n_s_yield_upslope_neighbors);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_xi);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
  __pyx_t_4 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_v_yi);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
  __pyx_t_5 = NULL;
  __pyx_t_6 = 0;
  if (CYTHON_UNPACK_METHODS &amp;&amp; likely(<span class='py_c_api'>PyMethod_Check</span>(__pyx_t_2))) {
    __pyx_t_5 = <span class='py_macro_api'>PyMethod_GET_SELF</span>(__pyx_t_2);
    if (likely(__pyx_t_5)) {
      PyObject* function = <span class='py_macro_api'>PyMethod_GET_FUNCTION</span>(__pyx_t_2);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(function);
      <span class='pyx_macro_api'>__Pyx_DECREF_SET</span>(__pyx_t_2, function);
      __pyx_t_6 = 1;
    }
  }
  #if CYTHON_FAST_PYCALL
  if (<span class='py_c_api'>PyFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_t_4};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  #if CYTHON_FAST_PYCCALL
  if (<span class='pyx_c_api'>__Pyx_PyFastCFunction_Check</span>(__pyx_t_2)) {
    PyObject *__pyx_temp[3] = {__pyx_t_5, __pyx_t_3, __pyx_t_4};
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyCFunction_FastCall</span>(__pyx_t_2, __pyx_temp+1-__pyx_t_6, 2+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
  } else
  #endif
  {
    __pyx_t_7 = <span class='py_c_api'>PyTuple_New</span>(2+__pyx_t_6);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    if (__pyx_t_5) {
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5); <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0, __pyx_t_5); __pyx_t_5 = NULL;
    }
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_3);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 0+__pyx_t_6, __pyx_t_3);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_4);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_7, 1+__pyx_t_6, __pyx_t_4);
    __pyx_t_3 = 0;
    __pyx_t_4 = 0;
    __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyObject_Call</span>(__pyx_t_2, __pyx_t_7, NULL);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
  __pyx_t_2 = <span class='py_c_api'>PySequence_List</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 329, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
  __pyx_v_ns = ((PyObject*)__pyx_t_2);
  __pyx_t_2 = 0;
</pre><pre class="cython line score-1" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">330</span>:         <span class="k">if</span> <span class="n">ns</span><span class="p">:</span></pre>
<pre class='cython code score-1 '>  __pyx_t_8 = (<span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_v_ns) != 0);
  if (__pyx_t_8) {
/* … */
  }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">331</span>:             <span class="k">return</span> <span class="bp">False</span></pre>
<pre class='cython code score-0 '>    __pyx_r = 0;
    goto __pyx_L0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">332</span>:         <span class="k">return</span> <span class="bp">True</span></pre>
<pre class='cython code score-0 '>  __pyx_r = 1;
  goto __pyx_L0;
</pre><pre class="cython line score-0">&#xA0;<span class="">333</span>: </pre>
<pre class="cython line score-66" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">334</span>:     <span class="k">def</span> <span class="nf">yield_upslope_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">long</span> <span class="n">xi</span><span class="p">,</span> <span class="nb">long</span> <span class="n">yi</span><span class="p">):</span></pre>
<pre class='cython code score-66 '>/* Python wrapper */
static PyObject *__pyx_pw_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_3yield_upslope_neighbors(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_2yield_upslope_neighbors[] = "Yield upslope neighbors of a given pixel.\n\n        Args:\n            xi (int): x coordinate of the pixel i to consider\n            yi (int): y coordinate of the pixel i to consider\n            skip_oob (bool): if True, do not yield neighbors that fall\n                outside the raster bounds.\n\n        Yields:\n            (j, xj, yj, p_ij) tuples representing neighboring pixels, where\n            j is the index 0-7 of the neighbor,\n            xj is the x coordinate of pixel j in raster space,\n            yj is the y coordinate of pixel j in raster space, and\n            p_ij is the proportion of flow from pixel j that flows into pixel i\n        ";
static PyObject *__pyx_pw_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_3yield_upslope_neighbors(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  long __pyx_v_xi;
  long __pyx_v_yi;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("yield_upslope_neighbors (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_xi,&amp;__pyx_n_s_yi,0};
    PyObject* values[2] = {0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_xi)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_yi)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("yield_upslope_neighbors", 1, 2, 2, 1); <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "yield_upslope_neighbors") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
      }
    } else if (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args) != 2) {
      goto __pyx_L5_argtuple_error;
    } else {
      values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
      values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
    }
    __pyx_v_xi = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[0]); if (unlikely((__pyx_v_xi == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
    __pyx_v_yi = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[1]); if (unlikely((__pyx_v_yi == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("yield_upslope_neighbors", 1, 2, 2, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("natcap.invest.managed_raster.managed_raster.ManagedFlowDirRaster.yield_upslope_neighbors", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_2yield_upslope_neighbors(((struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *)__pyx_v_self), __pyx_v_xi, __pyx_v_yi);
  int __pyx_lineno = 0;
  const char *__pyx_filename = NULL;
  int __pyx_clineno = 0;

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
static PyObject *__pyx_gb_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_23yield_upslope_neighbors_2generator2(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
/* … */
static PyObject *__pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_2yield_upslope_neighbors(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *__pyx_v_self, long __pyx_v_xi, long __pyx_v_yi) {
  struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct__yield_upslope_neighbors *__pyx_cur_scope;
  PyObject *__pyx_gb_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_23yield_upslope_neighbors_2generator2 = 0;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("yield_upslope_neighbors", 0);
  __pyx_cur_scope = (struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct__yield_upslope_neighbors *)__pyx_tp_new_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct__yield_upslope_neighbors(__pyx_ptype_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct__yield_upslope_neighbors, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct__yield_upslope_neighbors *)Py_None);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L1_error)</span>
  } else {
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_cur_scope);
  }
  __pyx_cur_scope-&gt;__pyx_v_self = __pyx_v_self;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_cur_scope-&gt;__pyx_v_self);
  <span class='refnanny'>__Pyx_GIVEREF</span>((PyObject *)__pyx_cur_scope-&gt;__pyx_v_self);
  __pyx_cur_scope-&gt;__pyx_v_xi = __pyx_v_xi;
  __pyx_cur_scope-&gt;__pyx_v_yi = __pyx_v_yi;
  {
    __pyx_CoroutineObject *gen = <span class='pyx_c_api'>__Pyx_Generator_New</span>((__pyx_coroutine_body_t) __pyx_gb_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_4generator, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_yield_upslope_neighbors, __pyx_n_s_ManagedFlowDirRaster_yield_upslo, __pyx_n_s_natcap_invest_managed_raster_man);<span class='error_goto'> if (unlikely(!gen)) __PYX_ERR(0, 334, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_cur_scope);
    <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("natcap.invest.managed_raster.managed_raster.ManagedFlowDirRaster.yield_upslope_neighbors", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_gb_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_23yield_upslope_neighbors_2generator2);
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_cur_scope));
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_gb_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_4generator(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("yield_upslope_neighbors", 0);
  <span class='trace'>__Pyx_TraceDeclarations</span>
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) <span class='error_goto'>__PYX_ERR(0, 334, __pyx_L1_error)</span>
/* … */
  /* function exit code */
  <span class='py_c_api'>PyErr_SetNone</span>(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_9);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_13);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("yield_upslope_neighbors", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  <span class='pyx_c_api'>__Pyx_Coroutine_ResetAndClearException</span>(__pyx_generator);
  #endif
  __pyx_generator-&gt;resume_label = -1;
  <span class='pyx_c_api'>__Pyx_Coroutine_clear</span>((PyObject*)__pyx_generator);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
static PyObject *__pyx_gb_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_7generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value); /* proto */
/* … */
struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct__yield_upslope_neighbors {
  PyObject_HEAD
  int __pyx_v_flow_dir_j;
  float __pyx_v_flow_dir_j_sum;
  float __pyx_v_flow_ji;
  PyObject *__pyx_v_genexpr;
  int __pyx_v_n_dir;
  PyObject *__pyx_v_p_ji;
  struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *__pyx_v_self;
  PyObject *__pyx_v_upslope_neighbor_tuples;
  long __pyx_v_xi;
  long __pyx_v_xj;
  long __pyx_v_yi;
  long __pyx_v_yj;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
};

</pre><pre class="cython line score-0">&#xA0;<span class="">335</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield upslope neighbors of a given pixel.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">336</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">337</span>: <span class="sd">        Args:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">338</span>: <span class="sd">            xi (int): x coordinate of the pixel i to consider</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">339</span>: <span class="sd">            yi (int): y coordinate of the pixel i to consider</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">340</span>: <span class="sd">            skip_oob (bool): if True, do not yield neighbors that fall</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">341</span>: <span class="sd">                outside the raster bounds.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">342</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">343</span>: <span class="sd">        Yields:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">344</span>: <span class="sd">            (j, xj, yj, p_ij) tuples representing neighboring pixels, where</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">345</span>: <span class="sd">            j is the index 0-7 of the neighbor,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">346</span>: <span class="sd">            xj is the x coordinate of pixel j in raster space,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">347</span>: <span class="sd">            yj is the y coordinate of pixel j in raster space, and</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">348</span>: <span class="sd">            p_ij is the proportion of flow from pixel j that flows into pixel i</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">349</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">350</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">n_dir</span><span class="p">,</span> <span class="nf">flow_dir_j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">351</span>:         <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">xj</span><span class="p">,</span> <span class="nf">yj</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">352</span>:         <span class="k">cdef</span> <span class="kt">float</span> <span class="nf">flow_ji</span><span class="p">,</span> <span class="nf">flow_dir_j_sum</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">353</span>: </pre>
<pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">354</span>:         <span class="n">upslope_neighbor_tuples</span> <span class="o">=</span> <span class="p">[]</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 354, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_cur_scope-&gt;__pyx_v_upslope_neighbor_tuples = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">355</span>:         <span class="k">for</span> <span class="n">n_dir</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mf">8</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  for (__pyx_t_2 = 0; __pyx_t_2 &lt; 8; __pyx_t_2+=1) {
    __pyx_cur_scope-&gt;__pyx_v_n_dir = __pyx_t_2;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">356</span>:             <span class="n">xj</span> <span class="o">=</span> <span class="n">xi</span> <span class="o">+</span> <span class="n">COL_OFFSETS</span><span class="p">[</span><span class="n">n_dir</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_cur_scope-&gt;__pyx_v_xj = (__pyx_cur_scope-&gt;__pyx_v_xi + (__pyx_v_6natcap_6invest_14managed_raster_14managed_raster_COL_OFFSETS[__pyx_cur_scope-&gt;__pyx_v_n_dir]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">357</span>:             <span class="n">yj</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">+</span> <span class="n">ROW_OFFSETS</span><span class="p">[</span><span class="n">n_dir</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_cur_scope-&gt;__pyx_v_yj = (__pyx_cur_scope-&gt;__pyx_v_yi + (__pyx_v_6natcap_6invest_14managed_raster_14managed_raster_ROW_OFFSETS[__pyx_cur_scope-&gt;__pyx_v_n_dir]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">358</span>:             <span class="k">if</span> <span class="p">(</span><span class="n">xj</span> <span class="o">&lt;</span> <span class="mf">0</span> <span class="ow">or</span> <span class="n">xj</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_x_size</span> <span class="ow">or</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = ((__pyx_cur_scope-&gt;__pyx_v_xj &lt; 0) != 0);
    if (!__pyx_t_4) {
    } else {
      __pyx_t_3 = __pyx_t_4;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_4 = ((__pyx_cur_scope-&gt;__pyx_v_xj &gt;= __pyx_cur_scope-&gt;__pyx_v_self-&gt;__pyx_base.raster_x_size) != 0);
    if (!__pyx_t_4) {
    } else {
      __pyx_t_3 = __pyx_t_4;
      goto __pyx_L7_bool_binop_done;
    }
/* … */
    if (__pyx_t_3) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">359</span>:                     <span class="n">yj</span> <span class="o">&lt;</span> <span class="mf">0</span> <span class="ow">or</span> <span class="n">yj</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_y_size</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = ((__pyx_cur_scope-&gt;__pyx_v_yj &lt; 0) != 0);
    if (!__pyx_t_4) {
    } else {
      __pyx_t_3 = __pyx_t_4;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_4 = ((__pyx_cur_scope-&gt;__pyx_v_yj &gt;= __pyx_cur_scope-&gt;__pyx_v_self-&gt;__pyx_base.raster_y_size) != 0);
    __pyx_t_3 = __pyx_t_4;
    __pyx_L7_bool_binop_done:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">360</span>:                 <span class="k">continue</span></pre>
<pre class='cython code score-0 '>      goto __pyx_L4_continue;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">361</span>:             <span class="n">flow_dir_j</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">xj</span><span class="p">,</span> <span class="n">yj</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>    __pyx_cur_scope-&gt;__pyx_v_flow_dir_j = ((int)((struct __pyx_vtabstruct_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *)__pyx_cur_scope-&gt;__pyx_v_self-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.get(((struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *)__pyx_cur_scope-&gt;__pyx_v_self), __pyx_cur_scope-&gt;__pyx_v_xj, __pyx_cur_scope-&gt;__pyx_v_yj));
</pre><pre class="cython line score-59" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">362</span>:             <span class="n">flow_dir_j_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(((</span><span class="n">flow_dir_j</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">n</span> <span class="o">*</span> <span class="mf">4</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mf">0</span><span class="n">xF</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mf">8</span><span class="p">))</span></pre>
<pre class='cython code score-59 '>static PyObject *__pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_23yield_upslope_neighbors_genexpr(PyObject *__pyx_self) {
  struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct_1_genexpr *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("genexpr", 0);
  __pyx_cur_scope = (struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct_1_genexpr *)__pyx_tp_new_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct_1_genexpr(__pyx_ptype_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct_1_genexpr, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct_1_genexpr *)Py_None);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    <span class='error_goto'>__PYX_ERR(0, 362, __pyx_L1_error)</span>
  } else {
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_cur_scope);
  }
  __pyx_cur_scope-&gt;__pyx_outer_scope = (struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct__yield_upslope_neighbors *) __pyx_self;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>(((PyObject *)__pyx_cur_scope-&gt;__pyx_outer_scope));
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_cur_scope-&gt;__pyx_outer_scope);
  {
    __pyx_CoroutineObject *gen = <span class='pyx_c_api'>__Pyx_Generator_New</span>((__pyx_coroutine_body_t) __pyx_gb_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_23yield_upslope_neighbors_2generator2, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_genexpr, __pyx_n_s_yield_upslope_neighbors_locals_g, __pyx_n_s_natcap_invest_managed_raster_man);<span class='error_goto'> if (unlikely(!gen)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_cur_scope);
    <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("natcap.invest.managed_raster.managed_raster.ManagedFlowDirRaster.yield_upslope_neighbors.genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_cur_scope));
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_gb_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_23yield_upslope_neighbors_2generator2(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("genexpr", 0);
  <span class='trace'>__Pyx_TraceDeclarations</span>
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) <span class='error_goto'>__PYX_ERR(0, 362, __pyx_L1_error)</span>
  for (__pyx_t_1 = 0; __pyx_t_1 &lt; 8; __pyx_t_1+=1) {
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_cur_scope-&gt;__pyx_v_n);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_cur_scope-&gt;__pyx_v_n, __pyx_t_2);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_2);
    __pyx_t_2 = 0;
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_cur_scope-&gt;__pyx_outer_scope-&gt;__pyx_v_flow_dir_j);<span class='error_goto'> if (unlikely(!__pyx_t_2)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_2);
    __pyx_t_3 = <span class='py_c_api'>PyNumber_Multiply</span>(__pyx_cur_scope-&gt;__pyx_v_n, __pyx_int_4);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    __pyx_t_4 = <span class='py_c_api'>PyNumber_Rshift</span>(__pyx_t_2, __pyx_t_3);<span class='error_goto'> if (unlikely(!__pyx_t_4)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_4);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_2); __pyx_t_2 = 0;
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_3); __pyx_t_3 = 0;
    __pyx_t_3 = <span class='pyx_c_api'>__Pyx_PyInt_AndObjC</span>(__pyx_t_4, __pyx_int_15, 0xF, 0, 0);<span class='error_goto'> if (unlikely(!__pyx_t_3)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_3);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_4); __pyx_t_4 = 0;
    __pyx_r = __pyx_t_3;
    __pyx_t_3 = 0;
    __pyx_cur_scope-&gt;__pyx_t_0 = __pyx_t_1;
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
    <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
    <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
    <span class='pyx_c_api'>__Pyx_Coroutine_ResetAndClearException</span>(__pyx_generator);
    /* return from generator, yielding value */
    __pyx_generator-&gt;resume_label = 1;
    return __pyx_r;
    __pyx_L6_resume_from_yield:;
    __pyx_t_1 = __pyx_cur_scope-&gt;__pyx_t_0;
    if (unlikely(!__pyx_sent_value)) <span class='error_goto'>__PYX_ERR(0, 362, __pyx_L1_error)</span>
  }
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);

  /* function exit code */
  <span class='py_c_api'>PyErr_SetNone</span>(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_2);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_3);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_4);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("genexpr", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  <span class='pyx_c_api'>__Pyx_Coroutine_ResetAndClearException</span>(__pyx_generator);
  #endif
  __pyx_generator-&gt;resume_label = -1;
  <span class='pyx_c_api'>__Pyx_Coroutine_clear</span>((PyObject*)__pyx_generator);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
    __pyx_t_1 = __pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_23yield_upslope_neighbors_genexpr(((PyObject*)__pyx_cur_scope));<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyObject_CallOneArg</span>(__pyx_builtin_sum, __pyx_t_1);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_6 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_5); if (unlikely((__pyx_t_6 == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 362, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_cur_scope-&gt;__pyx_v_flow_dir_j_sum = __pyx_t_6;
/* … */
struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct_1_genexpr {
  PyObject_HEAD
  struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct__yield_upslope_neighbors *__pyx_outer_scope;
  PyObject *__pyx_v_n;
  long __pyx_t_0;
};

</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">363</span>:             <span class="n">flow_ji</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0</span><span class="n">xF</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">flow_dir_j</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="mf">4</span> <span class="o">*</span> <span class="n">FLOW_DIR_REVERSE_DIRECTION</span><span class="p">[</span><span class="n">n_dir</span><span class="p">])))</span></pre>
<pre class='cython code score-0 '>    __pyx_cur_scope-&gt;__pyx_v_flow_ji = (0xF &amp; (__pyx_cur_scope-&gt;__pyx_v_flow_dir_j &gt;&gt; (4 * (__pyx_v_6natcap_6invest_14managed_raster_14managed_raster_FLOW_DIR_REVERSE_DIRECTION[__pyx_cur_scope-&gt;__pyx_v_n_dir]))));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">364</span>:             <span class="k">if</span> <span class="n">flow_ji</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_3 = (__pyx_cur_scope-&gt;__pyx_v_flow_ji != 0);
    if (__pyx_t_3) {
/* … */
    }
    __pyx_L4_continue:;
  }
</pre><pre class="cython line score-3" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">365</span>:                 <span class="n">upslope_neighbor_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">(</span></pre>
<pre class='cython code score-3 '>      __pyx_t_10 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_cur_scope-&gt;__pyx_v_upslope_neighbor_tuples, __pyx_t_9);<span class='error_goto'> if (unlikely(__pyx_t_10 == ((int)-1))) __PYX_ERR(0, 365, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
</pre><pre class="cython line score-25" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">366</span>:                     <span class="p">(</span><span class="n">n_dir</span><span class="p">,</span> <span class="n">xj</span><span class="p">,</span> <span class="n">yj</span><span class="p">,</span> <span class="n">flow_ji</span> <span class="o">/</span> <span class="n">flow_dir_j_sum</span><span class="p">))</span></pre>
<pre class='cython code score-25 '>      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_cur_scope-&gt;__pyx_v_n_dir);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 366, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_cur_scope-&gt;__pyx_v_xj);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 366, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_cur_scope-&gt;__pyx_v_yj);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 366, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      if (unlikely(__pyx_cur_scope-&gt;__pyx_v_flow_dir_j_sum == 0)) {
        <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
        <span class='error_goto'>__PYX_ERR(0, 366, __pyx_L1_error)</span>
      }
      __pyx_t_8 = <span class='py_c_api'>PyFloat_FromDouble</span>((__pyx_cur_scope-&gt;__pyx_v_flow_ji / __pyx_cur_scope-&gt;__pyx_v_flow_dir_j_sum));<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 366, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      __pyx_t_9 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_9)) __PYX_ERR(0, 366, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_9);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 0, __pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 1, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 2, __pyx_t_7);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_9, 3, __pyx_t_8);
      __pyx_t_5 = 0;
      __pyx_t_1 = 0;
      __pyx_t_7 = 0;
      __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">367</span>: </pre>
<pre class="cython line score-80" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">368</span>:         <span class="k">for</span> <span class="n">n_dir</span><span class="p">,</span> <span class="n">xj</span><span class="p">,</span> <span class="n">yj</span><span class="p">,</span> <span class="n">p_ji</span> <span class="ow">in</span> <span class="n">upslope_neighbor_tuples</span><span class="p">:</span></pre>
<pre class='cython code score-80 '>  __pyx_t_9 = __pyx_cur_scope-&gt;__pyx_v_upslope_neighbor_tuples; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_9); __pyx_t_11 = 0;
  for (;;) {
    if (__pyx_t_11 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_9)) break;
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_8 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_9, __pyx_t_11); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_11++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 368, __pyx_L1_error)</span>
    #else
    __pyx_t_8 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_9, __pyx_t_11); __pyx_t_11++;<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 368, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    #endif
    if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_8))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_8))) {
      PyObject* sequence = __pyx_t_8;
      Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
      if (unlikely(size != 4)) {
        if (size &gt; 4) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(4);
        else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
        <span class='error_goto'>__PYX_ERR(0, 368, __pyx_L1_error)</span>
      }
      #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
      if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
        __pyx_t_7 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
        __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
        __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 2); 
        __pyx_t_12 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 3); 
      } else {
        __pyx_t_7 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
        __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
        __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 2); 
        __pyx_t_12 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 3); 
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_12);
      #else
      {
        Py_ssize_t i;
        PyObject** temps[4] = {&amp;__pyx_t_7,&amp;__pyx_t_1,&amp;__pyx_t_5,&amp;__pyx_t_12};
        for (i=0; i &lt; 4; i++) {
          PyObject* item = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, i);<span class='error_goto'> if (unlikely(!item)) __PYX_ERR(0, 368, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(item);
          *(temps[i]) = item;
        }
      }
      #endif
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
    } else {
      Py_ssize_t index = -1;
      PyObject** temps[4] = {&amp;__pyx_t_7,&amp;__pyx_t_1,&amp;__pyx_t_5,&amp;__pyx_t_12};
      __pyx_t_13 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_8);<span class='error_goto'> if (unlikely(!__pyx_t_13)) __PYX_ERR(0, 368, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_13);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
      __pyx_t_14 = Py_TYPE(__pyx_t_13)-&gt;tp_iternext;
      for (index=0; index &lt; 4; index++) {
        PyObject* item = __pyx_t_14(__pyx_t_13); if (unlikely(!item)) goto __pyx_L14_unpacking_failed;
        <span class='refnanny'>__Pyx_GOTREF</span>(item);
        *(temps[index]) = item;
      }
      if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_14(__pyx_t_13), 4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 368, __pyx_L1_error)</span>
      __pyx_t_14 = NULL;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      goto __pyx_L15_unpacking_done;
      __pyx_L14_unpacking_failed:;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_13); __pyx_t_13 = 0;
      __pyx_t_14 = NULL;
      if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
      <span class='error_goto'>__PYX_ERR(0, 368, __pyx_L1_error)</span>
      __pyx_L15_unpacking_done:;
    }
    __pyx_t_2 = <span class='pyx_c_api'>__Pyx_PyInt_As_int</span>(__pyx_t_7); if (unlikely((__pyx_t_2 == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 368, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_1); if (unlikely((__pyx_t_15 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 368, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_16 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_5); if (unlikely((__pyx_t_16 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 368, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_cur_scope-&gt;__pyx_v_n_dir = __pyx_t_2;
    __pyx_cur_scope-&gt;__pyx_v_xj = __pyx_t_15;
    __pyx_cur_scope-&gt;__pyx_v_yj = __pyx_t_16;
    <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_cur_scope-&gt;__pyx_v_p_ji);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_cur_scope-&gt;__pyx_v_p_ji, __pyx_t_12);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
    __pyx_t_12 = 0;
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_9); __pyx_t_9 = 0;
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
</pre><pre class="cython line score-18" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">369</span>:             <span class="k">yield</span> <span class="n">n_dir</span><span class="p">,</span> <span class="n">xj</span><span class="p">,</span> <span class="n">yj</span><span class="p">,</span> <span class="n">p_ji</span></pre>
<pre class='cython code score-18 '>    __pyx_t_8 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_cur_scope-&gt;__pyx_v_n_dir);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 369, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
    __pyx_t_12 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_cur_scope-&gt;__pyx_v_xj);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 369, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
    __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_cur_scope-&gt;__pyx_v_yj);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 369, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    __pyx_t_1 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 369, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_8);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 0, __pyx_t_8);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_12);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 1, __pyx_t_12);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 2, __pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_cur_scope-&gt;__pyx_v_p_ji);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_cur_scope-&gt;__pyx_v_p_ji);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_1, 3, __pyx_cur_scope-&gt;__pyx_v_p_ji);
    __pyx_t_8 = 0;
    __pyx_t_12 = 0;
    __pyx_t_5 = 0;
    __pyx_r = __pyx_t_1;
    __pyx_t_1 = 0;
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_9);
    __pyx_cur_scope-&gt;__pyx_t_0 = __pyx_t_9;
    __pyx_cur_scope-&gt;__pyx_t_1 = __pyx_t_11;
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
    <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
    <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
    <span class='pyx_c_api'>__Pyx_Coroutine_ResetAndClearException</span>(__pyx_generator);
    /* return from generator, yielding value */
    __pyx_generator-&gt;resume_label = 1;
    return __pyx_r;
    __pyx_L16_resume_from_yield:;
    __pyx_t_9 = __pyx_cur_scope-&gt;__pyx_t_0;
    __pyx_cur_scope-&gt;__pyx_t_0 = 0;
    <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_9);
    __pyx_t_11 = __pyx_cur_scope-&gt;__pyx_t_1;
    if (unlikely(!__pyx_sent_value)) <span class='error_goto'>__PYX_ERR(0, 369, __pyx_L1_error)</span>
</pre><pre class="cython line score-0">&#xA0;<span class="">370</span>: </pre>
<pre class="cython line score-76" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">371</span>:     <span class="k">def</span> <span class="nf">yield_downslope_neighbors</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">long</span> <span class="n">xi</span><span class="p">,</span> <span class="nb">long</span> <span class="n">yi</span><span class="p">,</span> <span class="nb">bint</span> <span class="n">skip_oob</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span></pre>
<pre class='cython code score-76 '>/* Python wrapper */
static PyObject *__pyx_pw_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_6yield_downslope_neighbors(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds); /*proto*/
static char __pyx_doc_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_5yield_downslope_neighbors[] = "Yield downslope neighbors of a given pixel.\n\n        Args:\n            xi (int): x coordinate of the pixel i to consider\n            yi (int): y coordinate of the pixel i to consider\n            skip_oob (bool): if True, do not yield neighbors that fall\n                outside the raster bounds.\n\n        Yields:\n            (j, xj, yj, p_ij) tuples representing neighboring pixels, where\n            j is the index 0-7 of the neighbor,\n            xj is the x coordinate of pixel j in raster space,\n            yj is the y coordinate of pixel j in raster space, and\n            p_ij is the proportion of flow from pixel i that flows into pixel j\n        ";
static PyObject *__pyx_pw_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_6yield_downslope_neighbors(PyObject *__pyx_v_self, PyObject *__pyx_args, PyObject *__pyx_kwds) {
  long __pyx_v_xi;
  long __pyx_v_yi;
  int __pyx_v_skip_oob;
  PyObject *__pyx_r = 0;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("yield_downslope_neighbors (wrapper)", 0);
  {
    static PyObject **__pyx_pyargnames[] = {&amp;__pyx_n_s_xi,&amp;__pyx_n_s_yi,&amp;__pyx_n_s_skip_oob,0};
    PyObject* values[3] = {0,0,0};
    if (unlikely(__pyx_kwds)) {
      Py_ssize_t kw_args;
      const Py_ssize_t pos_args = <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args);
      switch (pos_args) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        CYTHON_FALLTHROUGH;
        case  1: values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        CYTHON_FALLTHROUGH;
        case  0: break;
        default: goto __pyx_L5_argtuple_error;
      }
      kw_args = <span class='py_c_api'>PyDict_Size</span>(__pyx_kwds);
      switch (pos_args) {
        case  0:
        if (likely((values[0] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_xi)) != 0)) kw_args--;
        else goto __pyx_L5_argtuple_error;
        CYTHON_FALLTHROUGH;
        case  1:
        if (likely((values[1] = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_yi)) != 0)) kw_args--;
        else {
          <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("yield_downslope_neighbors", 0, 2, 3, 1); <span class='error_goto'>__PYX_ERR(0, 371, __pyx_L3_error)</span>
        }
        CYTHON_FALLTHROUGH;
        case  2:
        if (kw_args &gt; 0) {
          PyObject* value = <span class='pyx_c_api'>__Pyx_PyDict_GetItemStr</span>(__pyx_kwds, __pyx_n_s_skip_oob);
          if (value) { values[2] = value; kw_args--; }
        }
      }
      if (unlikely(kw_args &gt; 0)) {
        if (unlikely(<span class='pyx_c_api'>__Pyx_ParseOptionalKeywords</span>(__pyx_kwds, __pyx_pyargnames, 0, values, pos_args, "yield_downslope_neighbors") &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 371, __pyx_L3_error)</span>
      }
    } else {
      switch (<span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)) {
        case  3: values[2] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 2);
        CYTHON_FALLTHROUGH;
        case  2: values[1] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 1);
        values[0] = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(__pyx_args, 0);
        break;
        default: goto __pyx_L5_argtuple_error;
      }
    }
    __pyx_v_xi = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[0]); if (unlikely((__pyx_v_xi == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 371, __pyx_L3_error)</span>
    __pyx_v_yi = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(values[1]); if (unlikely((__pyx_v_yi == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 371, __pyx_L3_error)</span>
    if (values[2]) {
      __pyx_v_skip_oob = <span class='pyx_c_api'>__Pyx_PyObject_IsTrue</span>(values[2]); if (unlikely((__pyx_v_skip_oob == (int)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 371, __pyx_L3_error)</span>
    } else {
      __pyx_v_skip_oob = ((int)1);
    }
  }
  goto __pyx_L4_argument_unpacking_done;
  __pyx_L5_argtuple_error:;
  <span class='pyx_c_api'>__Pyx_RaiseArgtupleInvalid</span>("yield_downslope_neighbors", 0, 2, 3, <span class='py_macro_api'>PyTuple_GET_SIZE</span>(__pyx_args)); <span class='error_goto'>__PYX_ERR(0, 371, __pyx_L3_error)</span>
  __pyx_L3_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("natcap.invest.managed_raster.managed_raster.ManagedFlowDirRaster.yield_downslope_neighbors", __pyx_clineno, __pyx_lineno, __pyx_filename);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return NULL;
  __pyx_L4_argument_unpacking_done:;
  __pyx_r = __pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_5yield_downslope_neighbors(((struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *)__pyx_v_self), __pyx_v_xi, __pyx_v_yi, __pyx_v_skip_oob);

  /* function exit code */
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_pf_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_5yield_downslope_neighbors(struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *__pyx_v_self, long __pyx_v_xi, long __pyx_v_yi, int __pyx_v_skip_oob) {
  struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct_2_yield_downslope_neighbors *__pyx_cur_scope;
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("yield_downslope_neighbors", 0);
  __pyx_cur_scope = (struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct_2_yield_downslope_neighbors *)__pyx_tp_new_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct_2_yield_downslope_neighbors(__pyx_ptype_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct_2_yield_downslope_neighbors, __pyx_empty_tuple, NULL);
  if (unlikely(!__pyx_cur_scope)) {
    __pyx_cur_scope = ((struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct_2_yield_downslope_neighbors *)Py_None);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(Py_None);
    <span class='error_goto'>__PYX_ERR(0, 371, __pyx_L1_error)</span>
  } else {
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_cur_scope);
  }
  __pyx_cur_scope-&gt;__pyx_v_self = __pyx_v_self;
  <span class='pyx_macro_api'>__Pyx_INCREF</span>((PyObject *)__pyx_cur_scope-&gt;__pyx_v_self);
  <span class='refnanny'>__Pyx_GIVEREF</span>((PyObject *)__pyx_cur_scope-&gt;__pyx_v_self);
  __pyx_cur_scope-&gt;__pyx_v_xi = __pyx_v_xi;
  __pyx_cur_scope-&gt;__pyx_v_yi = __pyx_v_yi;
  __pyx_cur_scope-&gt;__pyx_v_skip_oob = __pyx_v_skip_oob;
  {
    __pyx_CoroutineObject *gen = <span class='pyx_c_api'>__Pyx_Generator_New</span>((__pyx_coroutine_body_t) __pyx_gb_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_7generator1, NULL, (PyObject *) __pyx_cur_scope, __pyx_n_s_yield_downslope_neighbors, __pyx_n_s_ManagedFlowDirRaster_yield_downs, __pyx_n_s_natcap_invest_managed_raster_man);<span class='error_goto'> if (unlikely(!gen)) __PYX_ERR(0, 371, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_cur_scope);
    <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
    return (PyObject *) gen;
  }

  /* function exit code */
  __pyx_L1_error:;
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("natcap.invest.managed_raster.managed_raster.ManagedFlowDirRaster.yield_downslope_neighbors", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_r = NULL;
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(((PyObject *)__pyx_cur_scope));
  <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}

static PyObject *__pyx_gb_6natcap_6invest_14managed_raster_14managed_raster_20ManagedFlowDirRaster_7generator1(__pyx_CoroutineObject *__pyx_generator, CYTHON_UNUSED PyThreadState *__pyx_tstate, PyObject *__pyx_sent_value) /* generator body */
{
  PyObject *__pyx_r = NULL;
  <span class='refnanny'>__Pyx_RefNannyDeclarations</span>
  <span class='refnanny'>__Pyx_RefNannySetupContext</span>("yield_downslope_neighbors", 0);
  <span class='trace'>__Pyx_TraceDeclarations</span>
  __pyx_L3_first_run:;
  if (unlikely(!__pyx_sent_value)) <span class='error_goto'>__PYX_ERR(0, 371, __pyx_L1_error)</span>
/* … */
  /* function exit code */
  <span class='py_c_api'>PyErr_SetNone</span>(PyExc_StopIteration);
  goto __pyx_L0;
  __pyx_L1_error:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_1);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_5);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_6);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_7);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_8);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_11);
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_t_12);
  <span class='pyx_c_api'>__Pyx_AddTraceback</span>("yield_downslope_neighbors", __pyx_clineno, __pyx_lineno, __pyx_filename);
  __pyx_L0:;
  <span class='pyx_macro_api'>__Pyx_XDECREF</span>(__pyx_r); __pyx_r = 0;
  #if !CYTHON_USE_EXC_INFO_STACK
  <span class='pyx_c_api'>__Pyx_Coroutine_ResetAndClearException</span>(__pyx_generator);
  #endif
  __pyx_generator-&gt;resume_label = -1;
  <span class='pyx_c_api'>__Pyx_Coroutine_clear</span>((PyObject*)__pyx_generator);
  <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
  <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
  return __pyx_r;
}
/* … */
struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster___pyx_scope_struct_2_yield_downslope_neighbors {
  PyObject_HEAD
  PyObject *__pyx_v_downslope_neighbor_tuples;
  int __pyx_v_flow_dir;
  float __pyx_v_flow_ij;
  float __pyx_v_flow_sum;
  PyObject *__pyx_v_j;
  int __pyx_v_n_dir;
  float __pyx_v_p_ij;
  struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *__pyx_v_self;
  int __pyx_v_skip_oob;
  long __pyx_v_xi;
  long __pyx_v_xj;
  long __pyx_v_yi;
  long __pyx_v_yj;
  PyObject *__pyx_t_0;
  Py_ssize_t __pyx_t_1;
};


</pre><pre class="cython line score-0">&#xA0;<span class="">372</span>: <span class="w">        </span><span class="sd">&quot;&quot;&quot;Yield downslope neighbors of a given pixel.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">373</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">374</span>: <span class="sd">        Args:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">375</span>: <span class="sd">            xi (int): x coordinate of the pixel i to consider</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">376</span>: <span class="sd">            yi (int): y coordinate of the pixel i to consider</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">377</span>: <span class="sd">            skip_oob (bool): if True, do not yield neighbors that fall</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">378</span>: <span class="sd">                outside the raster bounds.</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">379</span>: </pre>
<pre class="cython line score-0">&#xA0;<span class="">380</span>: <span class="sd">        Yields:</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">381</span>: <span class="sd">            (j, xj, yj, p_ij) tuples representing neighboring pixels, where</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">382</span>: <span class="sd">            j is the index 0-7 of the neighbor,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">383</span>: <span class="sd">            xj is the x coordinate of pixel j in raster space,</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">384</span>: <span class="sd">            yj is the y coordinate of pixel j in raster space, and</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">385</span>: <span class="sd">            p_ij is the proportion of flow from pixel i that flows into pixel j</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">386</span>: <span class="sd">        &quot;&quot;&quot;</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">387</span>:         <span class="k">cdef</span> <span class="kt">int</span> <span class="nf">flow_dir</span><span class="p">,</span> <span class="nf">n_dir</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">388</span>:         <span class="k">cdef</span> <span class="kt">long</span> <span class="nf">xj</span><span class="p">,</span> <span class="nf">yj</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">389</span>:         <span class="k">cdef</span> <span class="kt">float</span> <span class="nf">flow_ij</span><span class="p">,</span> <span class="nf">flow_sum</span><span class="p">,</span> <span class="nf">p_ij</span></pre>
<pre class="cython line score-0">&#xA0;<span class="">390</span>: </pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">391</span>:         <span class="n">flow_dir</span> <span class="o">=</span> <span class="p">&lt;</span><span class="kt">int</span><span class="p">&gt;</span><span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">yi</span><span class="p">)</span></pre>
<pre class='cython code score-0 '>  __pyx_cur_scope-&gt;__pyx_v_flow_dir = ((int)((struct __pyx_vtabstruct_6natcap_6invest_14managed_raster_14managed_raster_ManagedFlowDirRaster *)__pyx_cur_scope-&gt;__pyx_v_self-&gt;__pyx_base.__pyx_vtab)-&gt;__pyx_base.get(((struct __pyx_obj_6natcap_6invest_14managed_raster_14managed_raster__ManagedRaster *)__pyx_cur_scope-&gt;__pyx_v_self), __pyx_cur_scope-&gt;__pyx_v_xi, __pyx_cur_scope-&gt;__pyx_v_yi));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">392</span>:         <span class="n">flow_sum</span> <span class="o">=</span> <span class="mf">0</span></pre>
<pre class='cython code score-0 '>  __pyx_cur_scope-&gt;__pyx_v_flow_sum = 0.0;
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">393</span>:         <span class="n">downslope_neighbor_tuples</span> <span class="o">=</span> <span class="p">[]</span></pre>
<pre class='cython code score-5 '>  __pyx_t_1 = <span class='py_c_api'>PyList_New</span>(0);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 393, __pyx_L1_error)</span>
  <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
  <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
  __pyx_cur_scope-&gt;__pyx_v_downslope_neighbor_tuples = ((PyObject*)__pyx_t_1);
  __pyx_t_1 = 0;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">394</span>:         <span class="k">for</span> <span class="n">n_dir</span> <span class="ow">in</span> <span class="nb">xrange</span><span class="p">(</span><span class="mf">8</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>  for (__pyx_t_2 = 0; __pyx_t_2 &lt; 8; __pyx_t_2+=1) {
    __pyx_cur_scope-&gt;__pyx_v_n_dir = __pyx_t_2;
</pre><pre class="cython line score-0">&#xA0;<span class="">395</span>:             <span class="c"># flows in this direction</span></pre>
<pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">396</span>:             <span class="n">xj</span> <span class="o">=</span> <span class="n">xi</span> <span class="o">+</span> <span class="n">COL_OFFSETS</span><span class="p">[</span><span class="n">n_dir</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_cur_scope-&gt;__pyx_v_xj = (__pyx_cur_scope-&gt;__pyx_v_xi + (__pyx_v_6natcap_6invest_14managed_raster_14managed_raster_COL_OFFSETS[__pyx_cur_scope-&gt;__pyx_v_n_dir]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">397</span>:             <span class="n">yj</span> <span class="o">=</span> <span class="n">yi</span> <span class="o">+</span> <span class="n">ROW_OFFSETS</span><span class="p">[</span><span class="n">n_dir</span><span class="p">]</span></pre>
<pre class='cython code score-0 '>    __pyx_cur_scope-&gt;__pyx_v_yj = (__pyx_cur_scope-&gt;__pyx_v_yi + (__pyx_v_6natcap_6invest_14managed_raster_14managed_raster_ROW_OFFSETS[__pyx_cur_scope-&gt;__pyx_v_n_dir]));
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">398</span>:             <span class="k">if</span> <span class="n">skip_oob</span> <span class="ow">and</span> <span class="p">(</span><span class="n">xj</span> <span class="o">&lt;</span> <span class="mf">0</span> <span class="ow">or</span> <span class="n">xj</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_x_size</span> <span class="ow">or</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = (__pyx_cur_scope-&gt;__pyx_v_skip_oob != 0);
    if (__pyx_t_4) {
    } else {
      __pyx_t_3 = __pyx_t_4;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_4 = ((__pyx_cur_scope-&gt;__pyx_v_xj &lt; 0) != 0);
    if (!__pyx_t_4) {
    } else {
      __pyx_t_3 = __pyx_t_4;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_4 = ((__pyx_cur_scope-&gt;__pyx_v_xj &gt;= __pyx_cur_scope-&gt;__pyx_v_self-&gt;__pyx_base.raster_x_size) != 0);
    if (!__pyx_t_4) {
    } else {
      __pyx_t_3 = __pyx_t_4;
      goto __pyx_L7_bool_binop_done;
    }
/* … */
    if (__pyx_t_3) {
/* … */
    }
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">399</span>:                     <span class="n">yj</span> <span class="o">&lt;</span> <span class="mf">0</span> <span class="ow">or</span> <span class="n">yj</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">raster_y_size</span><span class="p">):</span></pre>
<pre class='cython code score-0 '>    __pyx_t_4 = ((__pyx_cur_scope-&gt;__pyx_v_yj &lt; 0) != 0);
    if (!__pyx_t_4) {
    } else {
      __pyx_t_3 = __pyx_t_4;
      goto __pyx_L7_bool_binop_done;
    }
    __pyx_t_4 = ((__pyx_cur_scope-&gt;__pyx_v_yj &gt;= __pyx_cur_scope-&gt;__pyx_v_self-&gt;__pyx_base.raster_y_size) != 0);
    __pyx_t_3 = __pyx_t_4;
    __pyx_L7_bool_binop_done:;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">400</span>:                 <span class="k">continue</span></pre>
<pre class='cython code score-0 '>      goto __pyx_L4_continue;
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">401</span>:             <span class="n">flow_ij</span> <span class="o">=</span> <span class="p">(</span><span class="n">flow_dir</span> <span class="o">&gt;&gt;</span> <span class="p">(</span><span class="n">n_dir</span> <span class="o">*</span> <span class="mf">4</span><span class="p">))</span> <span class="o">&amp;</span> <span class="mf">0</span><span class="n">xF</span></pre>
<pre class='cython code score-0 '>    __pyx_cur_scope-&gt;__pyx_v_flow_ij = ((__pyx_cur_scope-&gt;__pyx_v_flow_dir &gt;&gt; (__pyx_cur_scope-&gt;__pyx_v_n_dir * 4)) &amp; 0xF);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">402</span>:             <span class="n">flow_sum</span> <span class="o">+=</span> <span class="n">flow_ij</span></pre>
<pre class='cython code score-0 '>    __pyx_cur_scope-&gt;__pyx_v_flow_sum = (__pyx_cur_scope-&gt;__pyx_v_flow_sum + __pyx_cur_scope-&gt;__pyx_v_flow_ij);
</pre><pre class="cython line score-0" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">403</span>:             <span class="k">if</span> <span class="n">flow_ij</span><span class="p">:</span></pre>
<pre class='cython code score-0 '>    __pyx_t_3 = (__pyx_cur_scope-&gt;__pyx_v_flow_ij != 0);
    if (__pyx_t_3) {
/* … */
    }
    __pyx_L4_continue:;
  }
</pre><pre class="cython line score-23" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">404</span>:                 <span class="n">downslope_neighbor_tuples</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n_dir</span><span class="p">,</span> <span class="n">xj</span><span class="p">,</span> <span class="n">yj</span><span class="p">,</span> <span class="n">flow_ij</span><span class="p">))</span></pre>
<pre class='cython code score-23 '>      __pyx_t_1 = <span class='pyx_c_api'>__Pyx_PyInt_From_int</span>(__pyx_cur_scope-&gt;__pyx_v_n_dir);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
      __pyx_t_5 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_cur_scope-&gt;__pyx_v_xj);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
      __pyx_t_6 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_cur_scope-&gt;__pyx_v_yj);<span class='error_goto'> if (unlikely(!__pyx_t_6)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_6);
      __pyx_t_7 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_cur_scope-&gt;__pyx_v_flow_ij);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
      __pyx_t_8 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_8)) __PYX_ERR(0, 404, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_8);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 0, __pyx_t_1);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_5);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 1, __pyx_t_5);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 2, __pyx_t_6);
      <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
      <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_8, 3, __pyx_t_7);
      __pyx_t_1 = 0;
      __pyx_t_5 = 0;
      __pyx_t_6 = 0;
      __pyx_t_7 = 0;
      __pyx_t_9 = <span class='pyx_c_api'>__Pyx_PyList_Append</span>(__pyx_cur_scope-&gt;__pyx_v_downslope_neighbor_tuples, __pyx_t_8);<span class='error_goto'> if (unlikely(__pyx_t_9 == ((int)-1))) __PYX_ERR(0, 404, __pyx_L1_error)</span>
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
</pre><pre class="cython line score-0">&#xA0;<span class="">405</span>: </pre>
<pre class="cython line score-83" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">406</span>:         <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">xj</span><span class="p">,</span> <span class="n">yj</span><span class="p">,</span> <span class="n">flow_ij</span> <span class="ow">in</span> <span class="n">downslope_neighbor_tuples</span><span class="p">:</span></pre>
<pre class='cython code score-83 '>  __pyx_t_8 = __pyx_cur_scope-&gt;__pyx_v_downslope_neighbor_tuples; <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_8); __pyx_t_10 = 0;
  for (;;) {
    if (__pyx_t_10 &gt;= <span class='py_macro_api'>PyList_GET_SIZE</span>(__pyx_t_8)) break;
    #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
    __pyx_t_7 = <span class='py_macro_api'>PyList_GET_ITEM</span>(__pyx_t_8, __pyx_t_10); <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_7); __pyx_t_10++; if (unlikely(0 &lt; 0)) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
    #else
    __pyx_t_7 = <span class='py_macro_api'>PySequence_ITEM</span>(__pyx_t_8, __pyx_t_10); __pyx_t_10++;<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    #endif
    if ((likely(<span class='py_c_api'>PyTuple_CheckExact</span>(__pyx_t_7))) || (<span class='py_c_api'>PyList_CheckExact</span>(__pyx_t_7))) {
      PyObject* sequence = __pyx_t_7;
      Py_ssize_t size = <span class='pyx_c_api'>__Pyx_PySequence_SIZE</span>(sequence);
      if (unlikely(size != 4)) {
        if (size &gt; 4) <span class='pyx_c_api'>__Pyx_RaiseTooManyValuesError</span>(4);
        else if (size &gt;= 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(size);
        <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
      }
      #if CYTHON_ASSUME_SAFE_MACROS &amp;&amp; !CYTHON_AVOID_BORROWED_REFS
      if (likely(<span class='py_c_api'>PyTuple_CheckExact</span>(sequence))) {
        __pyx_t_6 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 0); 
        __pyx_t_5 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 1); 
        __pyx_t_1 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 2); 
        __pyx_t_11 = <span class='py_macro_api'>PyTuple_GET_ITEM</span>(sequence, 3); 
      } else {
        __pyx_t_6 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 0); 
        __pyx_t_5 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 1); 
        __pyx_t_1 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 2); 
        __pyx_t_11 = <span class='py_macro_api'>PyList_GET_ITEM</span>(sequence, 3); 
      }
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_6);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_5);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_1);
      <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_t_11);
      #else
      {
        Py_ssize_t i;
        PyObject** temps[4] = {&amp;__pyx_t_6,&amp;__pyx_t_5,&amp;__pyx_t_1,&amp;__pyx_t_11};
        for (i=0; i &lt; 4; i++) {
          PyObject* item = <span class='py_macro_api'>PySequence_ITEM</span>(sequence, i);<span class='error_goto'> if (unlikely(!item)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
          <span class='refnanny'>__Pyx_GOTREF</span>(item);
          *(temps[i]) = item;
        }
      }
      #endif
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
    } else {
      Py_ssize_t index = -1;
      PyObject** temps[4] = {&amp;__pyx_t_6,&amp;__pyx_t_5,&amp;__pyx_t_1,&amp;__pyx_t_11};
      __pyx_t_12 = <span class='py_c_api'>PyObject_GetIter</span>(__pyx_t_7);<span class='error_goto'> if (unlikely(!__pyx_t_12)) __PYX_ERR(0, 406, __pyx_L1_error)</span>
      <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_12);
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_7); __pyx_t_7 = 0;
      __pyx_t_13 = Py_TYPE(__pyx_t_12)-&gt;tp_iternext;
      for (index=0; index &lt; 4; index++) {
        PyObject* item = __pyx_t_13(__pyx_t_12); if (unlikely(!item)) goto __pyx_L15_unpacking_failed;
        <span class='refnanny'>__Pyx_GOTREF</span>(item);
        *(temps[index]) = item;
      }
      if (<span class='pyx_c_api'>__Pyx_IternextUnpackEndCheck</span>(__pyx_t_13(__pyx_t_12), 4) &lt; 0) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
      __pyx_t_13 = NULL;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      goto __pyx_L16_unpacking_done;
      __pyx_L15_unpacking_failed:;
      <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_12); __pyx_t_12 = 0;
      __pyx_t_13 = NULL;
      if (<span class='pyx_c_api'>__Pyx_IterFinish</span>() == 0) <span class='pyx_c_api'>__Pyx_RaiseNeedMoreValuesError</span>(index);
      <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
      __pyx_L16_unpacking_done:;
    }
    __pyx_t_14 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_5); if (unlikely((__pyx_t_14 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_5); __pyx_t_5 = 0;
    __pyx_t_15 = <span class='pyx_c_api'>__Pyx_PyInt_As_long</span>(__pyx_t_1); if (unlikely((__pyx_t_15 == (long)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_1); __pyx_t_1 = 0;
    __pyx_t_16 = __pyx_<span class='py_c_api'>PyFloat_AsFloat</span>(__pyx_t_11); if (unlikely((__pyx_t_16 == (float)-1) &amp;&amp; <span class='py_c_api'>PyErr_Occurred</span>())) <span class='error_goto'>__PYX_ERR(0, 406, __pyx_L1_error)</span>
    <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_11); __pyx_t_11 = 0;
    <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_cur_scope-&gt;__pyx_v_j);
    <span class='pyx_macro_api'>__Pyx_XDECREF_SET</span>(__pyx_cur_scope-&gt;__pyx_v_j, __pyx_t_6);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_6);
    __pyx_t_6 = 0;
    __pyx_cur_scope-&gt;__pyx_v_xj = __pyx_t_14;
    __pyx_cur_scope-&gt;__pyx_v_yj = __pyx_t_15;
    __pyx_cur_scope-&gt;__pyx_v_flow_ij = __pyx_t_16;
/* … */
  }
  <span class='pyx_macro_api'>__Pyx_DECREF</span>(__pyx_t_8); __pyx_t_8 = 0;
  CYTHON_MAYBE_UNUSED_VAR(__pyx_cur_scope);
</pre><pre class="cython line score-5" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">407</span>:             <span class="n">p_ij</span> <span class="o">=</span> <span class="n">flow_ij</span> <span class="o">/</span> <span class="n">flow_sum</span></pre>
<pre class='cython code score-5 '>    if (unlikely(__pyx_cur_scope-&gt;__pyx_v_flow_sum == 0)) {
      <span class='py_c_api'>PyErr_SetString</span>(PyExc_ZeroDivisionError, "float division");
      <span class='error_goto'>__PYX_ERR(0, 407, __pyx_L1_error)</span>
    }
    __pyx_cur_scope-&gt;__pyx_v_p_ij = (__pyx_cur_scope-&gt;__pyx_v_flow_ij / __pyx_cur_scope-&gt;__pyx_v_flow_sum);
</pre><pre class="cython line score-21" onclick="(function(s){s.display=s.display==='block'?'none':'block'})(this.nextElementSibling.style)">+<span class="">408</span>:             <span class="k">yield</span> <span class="n">j</span><span class="p">,</span> <span class="n">xj</span><span class="p">,</span> <span class="n">yj</span><span class="p">,</span> <span class="n">p_ij</span></pre>
<pre class='cython code score-21 '>    __pyx_t_7 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_cur_scope-&gt;__pyx_v_xj);<span class='error_goto'> if (unlikely(!__pyx_t_7)) __PYX_ERR(0, 408, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_7);
    __pyx_t_11 = <span class='pyx_c_api'>__Pyx_PyInt_From_long</span>(__pyx_cur_scope-&gt;__pyx_v_yj);<span class='error_goto'> if (unlikely(!__pyx_t_11)) __PYX_ERR(0, 408, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_11);
    __pyx_t_1 = <span class='py_c_api'>PyFloat_FromDouble</span>(__pyx_cur_scope-&gt;__pyx_v_p_ij);<span class='error_goto'> if (unlikely(!__pyx_t_1)) __PYX_ERR(0, 408, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_1);
    __pyx_t_5 = <span class='py_c_api'>PyTuple_New</span>(4);<span class='error_goto'> if (unlikely(!__pyx_t_5)) __PYX_ERR(0, 408, __pyx_L1_error)</span>
    <span class='refnanny'>__Pyx_GOTREF</span>(__pyx_t_5);
    <span class='pyx_macro_api'>__Pyx_INCREF</span>(__pyx_cur_scope-&gt;__pyx_v_j);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_cur_scope-&gt;__pyx_v_j);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 0, __pyx_cur_scope-&gt;__pyx_v_j);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_7);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 1, __pyx_t_7);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_11);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 2, __pyx_t_11);
    <span class='refnanny'>__Pyx_GIVEREF</span>(__pyx_t_1);
    <span class='py_macro_api'>PyTuple_SET_ITEM</span>(__pyx_t_5, 3, __pyx_t_1);
    __pyx_t_7 = 0;
    __pyx_t_11 = 0;
    __pyx_t_1 = 0;
    __pyx_r = __pyx_t_5;
    __pyx_t_5 = 0;
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_t_8);
    __pyx_cur_scope-&gt;__pyx_t_0 = __pyx_t_8;
    __pyx_cur_scope-&gt;__pyx_t_1 = __pyx_t_10;
    <span class='refnanny'>__Pyx_XGIVEREF</span>(__pyx_r);
    <span class='trace'>__Pyx_TraceReturn</span>(__pyx_r, 0);
    <span class='refnanny'>__Pyx_RefNannyFinishContext</span>();
    <span class='pyx_c_api'>__Pyx_Coroutine_ResetAndClearException</span>(__pyx_generator);
    /* return from generator, yielding value */
    __pyx_generator-&gt;resume_label = 1;
    return __pyx_r;
    __pyx_L17_resume_from_yield:;
    __pyx_t_8 = __pyx_cur_scope-&gt;__pyx_t_0;
    __pyx_cur_scope-&gt;__pyx_t_0 = 0;
    <span class='refnanny'>__Pyx_XGOTREF</span>(__pyx_t_8);
    __pyx_t_10 = __pyx_cur_scope-&gt;__pyx_t_1;
    if (unlikely(!__pyx_sent_value)) <span class='error_goto'>__PYX_ERR(0, 408, __pyx_L1_error)</span>
</pre></div></body></html>
